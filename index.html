<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Startosphere Pos</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #3498db;
            --primary-light: #5dade2;
            --primary-dark: #2980b9;
            --secondary: #2ecc71;
            --danger: #e74c3c;
            --warning: #f39c12;
            --info: #1abc9c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --gray: #95a5a6;
            --sidebar-width: 250px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: var(--dark);
            overflow-x: hidden;
        }
        
        .container {
            display: flex;
            min-height: 100vh;
        }
        
        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: linear-gradient(180deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 20px 0;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            transition: all 0.3s;
            z-index: 100;
        }
        
        .logo {
            text-align: center;
            padding: 0 20px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 20px;
        }
        
        .logo h1 {
            font-size: 1.5rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .nav-menu {
            list-style: none;
        }
        
        .nav-item {
            padding: 15px 20px;
            cursor: pointer;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            border-left: 4px solid transparent;
        }
        
        .nav-item:hover, .nav-item.active {
            background-color: rgba(255,255,255,0.1);
            border-left-color: white;
        }
        
        .nav-item i {
            margin-right: 12px;
            font-size: 1.2rem;
            width: 24px;
            text-align: center;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            transition: all 0.3s;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #ddd;
            background: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .user-info {
            display: flex;
            align-items: center;
        }
        
        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        /* POS Screen */
        .pos-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
        }
        
        .products-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .search-box {
            position: relative;
            width: 300px;
        }
        
        .search-box input {
            width: 100%;
            padding: 12px 15px 12px 40px;
            border: 1px solid #ddd;
            border-radius: 30px;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .search-box input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
            outline: none;
        }
        
        .search-box i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
        }
        
        .category-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .category-tab {
            padding: 8px 15px;
            background: var(--light);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .category-tab.active {
            background: var(--primary);
            color: white;
        }
        
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 15px;
            max-height: 65vh;
            overflow-y: auto;
            padding: 5px;
        }
        
        .product-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            border: 1px solid #f0f0f0;
            position: relative;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .product-card.low-stock {
            border-left: 4px solid var(--warning);
        }
        
        .product-card.out-of-stock {
            opacity: 0.6;
            pointer-events: none;
        }
        
        .stock-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--warning);
            color: white;
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 10px;
        }
        
        .out-of-stock-badge {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--danger);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
        }
        
        .product-image {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
            margin: 0 auto 10px;
            background: linear-gradient(135deg, #f0f0f0, #e0e0e0);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray);
            font-size: 2rem;
        }
        
        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px;
        }
        
        .product-name {
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 0.95rem;
        }
        
        .product-price {
            color: var(--primary);
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .cart-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            height: fit-content;
            position: sticky;
            top: 20px;
        }
        
        .cart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .cart-items {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 15px;
        }
        
        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f5f5f5;
        }
        
        .item-info {
            flex: 1;
        }
        
        .item-name {
            font-weight: 500;
        }
        
        .item-price {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .quantity-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: none;
            background-color: var(--light);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .quantity-btn:hover {
            background-color: var(--primary);
            color: white;
        }
        
        .quantity {
            margin: 0 5px;
            font-weight: 500;
            min-width: 20px;
            text-align: center;
        }
        
        .item-total {
            font-weight: bold;
            min-width: 70px;
            text-align: right;
        }
        
        .remove-item {
            color: var(--danger);
            cursor: pointer;
            margin-left: 10px;
            opacity: 0.7;
            transition: opacity 0.2s;
        }
        
        .remove-item:hover {
            opacity: 1;
        }
        
        .cart-summary {
            border-top: 1px solid #eee;
            padding-top: 15px;
        }
        
        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .total {
            font-weight: bold;
            font-size: 1.3rem;
            color: var(--primary);
            border-top: 1px solid #eee;
            padding-top: 10px;
        }
        
        .payment-section {
            margin-top: 20px;
        }
        
        .payment-methods {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .payment-btn {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        
        .payment-btn.active {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .payment-icon {
            font-size: 1.2rem;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .input-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            transition: all 0.2s;
        }
        
        .input-group input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
            outline: none;
        }
        
        .input-group input:read-only {
            background-color: #f9f9f9;
            cursor: not-allowed;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 14px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            flex: 1;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-primary {
            background-color: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .btn-secondary {
            background-color: var(--light);
            color: var(--dark);
        }
        
        .btn-secondary:hover {
            background-color: #dde4e6;
        }
        
        .btn-success {
            background-color: var(--secondary);
            color: white;
        }
        
        .btn-success:hover {
            background-color: #27ae60;
        }
        
        .btn-danger {
            background-color: var(--danger);
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #c0392b;
        }
        
        .btn-warning {
            background-color: var(--warning);
            color: white;
        }
        
        .btn-warning:hover {
            background-color: #e67e22;
        }
        
        /* Management Screens */
        .management-screen {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: none;
        }
        
        .management-screen.active {
            display: block;
        }
        
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
            border-radius: 8px;
            border: 1px solid #eee;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: var(--dark);
        }
        
        tr:hover {
            background-color: #f8f9fa;
        }
        
        .action-cell {
            display: flex;
            gap: 8px;
        }
        
        .action-btn {
            padding: 6px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
        }
        
        .edit-btn {
            background-color: var(--info);
            color: white;
        }
        
        .delete-btn {
            background-color: var(--danger);
            color: white;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            transition: all 0.2s;
        }
        
        .form-control:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
            outline: none;
        }
        
        .form-row {
            display: flex;
            gap: 15px;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        /* Stats Cards */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            text-align: center;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
            margin: 10px 0;
        }
        
        .stat-label {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        /* Login Screen */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
        }
        
        .login-box {
            background: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
        }
        
        .login-logo {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .login-logo h1 {
            color: var(--primary);
            font-size: 2rem;
        }
        
        .login-error {
            color: var(--danger);
            text-align: center;
            margin-top: 10px;
            font-size: 0.9rem;
            display: none;
        }
        
        .login-error.show {
            display: block;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            margin: 0;
            color: var(--dark);
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
            transition: color 0.2s;
        }
        
        .modal-close:hover {
            color: var(--danger);
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        /* Responsive */
        @media (max-width: 992px) {
            .pos-container {
                grid-template-columns: 1fr;
            }
            
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            }
        }
        
        @media (max-width: 768px) {
            .sidebar {
                width: 70px;
                overflow: hidden;
            }
            
            .sidebar:hover {
                width: var(--sidebar-width);
            }
            
            .logo h1 span, .nav-item span {
                display: none;
            }
            
            .sidebar:hover .logo h1 span,
            .sidebar:hover .nav-item span {
                display: inline;
            }
            
            .nav-item {
                justify-content: center;
            }
            
            .sidebar:hover .nav-item {
                justify-content: flex-start;
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }
        
        /* Notifications */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 5px;
            color: white;
            z-index: 1000;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            gap: 10px;
            transform: translateX(150%);
            transition: transform 0.3s ease-out;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            background-color: var(--secondary);
        }
        
        .notification.error {
            background-color: var(--danger);
        }
        
        .notification.warning {
            background-color: var(--warning);
        }
        
        /* QR Payment Modal */
        .qr-modal {
            max-width: 500px;
        }
        
        .qr-container {
            text-align: center;
            padding: 20px;
        }
        
        .qr-code {
            width: 300px;
            height: 300px;
            margin: 0 auto 20px;
            background: white;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            padding: 15px;
            border: 2px solid var(--primary);
        }
        
        .qr-code img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 10px;
        }
        
        .payment-details {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            border-left: 4px solid var(--primary);
        }
        
        .payment-details h4 {
            margin-bottom: 15px;
            color: var(--dark);
            font-size: 1.2rem;
        }
        
        .payment-details p {
            margin: 8px 0;
            color: var(--dark);
            font-size: 1rem;
        }
        
        .payment-timer {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
            margin: 20px 0;
            background: #f8f9fa;
            padding: 10px 20px;
            border-radius: 10px;
            display: inline-block;
        }
        
        /* Member Section */
        .member-section {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .member-input {
            display: flex;
            gap: 10px;
        }
        
        .member-input input {
            flex: 1;
        }
        
        .discount-badge {
            background: var(--secondary);
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            margin-left: 5px;
        }
        
        /* QR Warning */
        .qr-warning {
            color: #e74c3c;
            font-size: 0.85rem;
            margin-top: 10px;
            padding: 8px;
            background: #ffeaea;
            border-radius: 5px;
            border-left: 3px solid #e74c3c;
        }
        
        .role-indicator {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-left: 10px;
        }
        
        .role-admin {
            background-color: #e74c3c;
            color: white;
        }
        
        .role-staff {
            background-color: #3498db;
            color: white;
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-container" id="loginScreen">
        <div class="login-box">
            <div class="login-logo">
                <h1><i class="fas fa-cash-register"></i> POS System</h1>
                <p>ระบบขายหน้าร้านแบบครบวงจร</p>
            </div>
            <div class="form-group">
                <label for="password">รหัสผ่านเข้าใช้งาน</label>
                <input type="password" id="password" class="form-control" placeholder="กรอกรหัสผ่าน" autofocus>
            </div>
            <div class="login-error" id="loginError">
                รหัสผ่านไม่ถูกต้อง
            </div>
            <button class="btn btn-primary" id="loginBtn" style="width: 100%; margin-top: 10px;">
                <i class="fas fa-sign-in-alt"></i> เข้าสู่ระบบ
            </button>
            <div style="margin-top: 20px; text-align: center; color: var(--gray); font-size: 0.9rem;">
                <p><strong>รหัสผ่านทดสอบ:</strong></p>
                <p><strong>101617</strong> - โหมดแอดมิน (เข้าถึงทุกฟังก์ชัน)</p>
                <p><strong>123456</strong> - โหมดพนักงาน (เข้าถึงฟังก์ชันพื้นฐาน)</p>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div class="container" id="appContainer" style="display: none;">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo">
                <h1><i class="fas fa-store"></i> <span>Startosphere</span></h1>
            </div>
            <ul class="nav-menu">
                <li class="nav-item active" data-screen="pos">
                    <i class="fas fa-shopping-cart"></i> <span>หน้าขาย (POS)</span>
                </li>
                <li class="nav-item" data-screen="products" id="productsNav">
                    <i class="fas fa-boxes"></i> <span>จัดการสินค้า</span>
                </li>
                <li class="nav-item" data-screen="sales">
                    <i class="fas fa-chart-bar"></i> <span>สรุปยอดขาย</span>
                </li>
                <li class="nav-item" data-screen="users" id="usersNav">
                    <i class="fas fa-users"></i> <span>ระบบผู้ใช้</span>
                </li>
                <li class="nav-item" data-screen="members" id="membersNav">
                    <i class="fas fa-id-card"></i> <span>สมาชิก</span>
                </li>
                <li class="nav-item" data-screen="discountCodes" id="discountCodesNav">
                    <i class="fas fa-tags"></i> <span>โค้ดส่วนลด</span>
                </li>
                <li class="nav-item" data-screen="qr" id="qrNav">
                    <i class="fas fa-qrcode"></i> <span>QR พร้อมเพย์</span>
                </li>
                <li class="nav-item" data-screen="logs">
                    <i class="fas fa-history"></i> <span>ประวัติการขาย</span>
                </li>
                <li class="nav-item" data-screen="settings" id="settingsNav">
                    <i class="fas fa-cog"></i> <span>การตั้งค่า</span>
                </li>
                <li class="nav-item" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i> <span>ออกจากระบบ</span>
                </li>
            </ul>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <div class="header">
                <h2 id="screenTitle">หน้าขาย (POS)</h2>
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">A</div>
                    <div>
                        <div id="userName">ผู้ใช้งาน</div>
                        <div style="font-size: 0.8rem; color: var(--gray);" id="currentTime">กำลังโหลด...</div>
                    </div>
                </div>
            </div>
            
            <!-- POS Screen -->
            <div class="management-screen active" id="posScreen">
                <div class="pos-container">
                    <!-- Products Section -->
                    <div class="products-section">
                        <div class="section-header">
                            <h3>เลือกสินค้า</h3>
                            <div class="search-box">
                                <i class="fas fa-search"></i>
                                <input type="text" id="productSearch" placeholder="ค้นหาสินค้า...">
                            </div>
                        </div>
                        
                        <div class="category-tabs" id="categoryTabs">
                            <!-- Categories will be loaded here -->
                        </div>
                        
                        <div class="products-grid" id="productsGrid">
                            <!-- Products will be loaded here by JavaScript -->
                        </div>
                    </div>
                    
                    <!-- Cart -->
                    <div class="cart-container">
                        <div class="cart-header">
                            <h3>รายการขาย</h3>
                            <button class="btn btn-secondary" id="clearCart">
                                <i class="fas fa-trash"></i> ล้างรายการ
                            </button>
                        </div>
                        
                        <!-- Member Section -->
                        <div class="member-section">
                            <h4>สมาชิก</h4>
                            <div class="member-search">
                                <div class="member-input">
                                    <input type="text" id="memberCode" class="form-control" placeholder="ค้นหาสมาชิก (ชื่อหรือรหัส)">
                                    <button class="btn btn-secondary" id="applyMember">
                                        <i class="fas fa-check"></i> ใช้
                                    </button>
                                </div>
                                <div class="member-results" id="memberResults">
                                    <!-- Member search results will appear here -->
                                </div>
                            </div>
                            <div id="memberInfo" style="display: none; margin-top: 10px;">
                                <div class="summary-row">
                                    <span>สมาชิก:</span>
                                    <span id="memberName">-</span>
                                </div>
                                <div class="summary-row">
                                    <span>ส่วนลด:</span>
                                    <span id="memberDiscount">0%</span>
                                </div>
                                <div class="summary-row">
                                    <span>คะแนน:</span>
                                    <span id="memberPoints">0</span>
                                </div>
                                <div class="action-buttons" style="margin-top: 10px;">
                                    <button class="btn btn-warning" id="redeemPoints" style="font-size: 0.8rem; padding: 8px 12px;">
                                        <i class="fas fa-gift"></i> แลกคะแนน
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Code Section -->
                        <div class="code-section">
                            <h4>โค้ดส่วนลด</h4>
                            <div class="code-input">
                                <input type="text" id="discountCode" class="form-control" placeholder="รหัสส่วนลด" disabled>
                                <button class="btn btn-secondary" id="applyDiscount" disabled>
                                    <i class="fas fa-tag"></i> ใช้
                                </button>
                            </div>
                            <div id="codeInfo" style="display: none; margin-top: 10px;">
                                <div class="summary-row">
                                    <span>โค้ด:</span>
                                    <span id="codeName">-</span>
                                </div>
                                <div class="summary-row">
                                    <span>ส่วนลด:</span>
                                    <span id="codeDiscount">0 ฿</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="cart-items" id="cartItems">
                            <!-- Cart items will be loaded here by JavaScript -->
                        </div>
                        
                        <div class="cart-summary">
                            <div class="summary-row">
                                <span>รวม:</span>
                                <span id="subtotal">0.00 ฿</span>
                            </div>
                            <div class="summary-row" id="discountRow" style="display: none;">
                                <span>ส่วนลด:</span>
                                <span id="discountAmount">0.00 ฿</span>
                            </div>
                            <div class="summary-row total">
                                <span>ยอดรวมทั้งหมด:</span>
                                <span id="total">0.00 ฿</span>
                            </div>
                        </div>
                        
                        <div class="payment-section">
                            <h4 style="margin-bottom: 10px;">ชำระเงิน</h4>
                            
                            <div class="payment-methods">
                                <div class="payment-btn active" data-method="cash">
                                    <i class="fas fa-money-bill-wave payment-icon"></i>
                                    <span>เงินสด</span>
                                </div>
                                <div class="payment-btn" data-method="promptpay">
                                    <i class="fas fa-qrcode payment-icon"></i>
                                    <span>พร้อมเพย์</span>
                                </div>
                            </div>
                            
                            <div class="input-group" id="cashInputGroup">
                                <label for="cashReceived">จำนวนเงินที่ลูกค้าจ่าย</label>
                                <input type="number" id="cashReceived" placeholder="0.00">
                            </div>
                            
                            <div class="input-group">
                                <label for="change">เงินทอน</label>
                                <input type="text" id="change" placeholder="0.00" readonly>
                            </div>
                            
                            <div class="action-buttons">
                                <button class="btn btn-success" id="completeSale">
                                    <i class="fas fa-check"></i> ขายสินค้า
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Products Management Screen -->
            <div class="management-screen" id="productsScreen">
                <div class="section-header">
                    <h3>จัดการสินค้า</h3>
                    <button class="btn btn-primary" id="addProductBtn">
                        <i class="fas fa-plus"></i> เพิ่มสินค้า
                    </button>
                </div>
                
                <div class="table-container">
                    <table id="productsTable">
                        <thead>
                            <tr>
                                <th>รูป</th>
                                <th>ชื่อสินค้า</th>
                                <th>หมวดหมู่</th>
                                <th>ราคาขาย</th>
                                <th>ต้นทุน</th>
                                <th>กำไร</th>
                                <th>สต็อก</th>
                                <th>สถานะ</th>
                                <th>การจัดการ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Products will be loaded here by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Sales Report Screen -->
            <div class="management-screen" id="salesScreen">
                <div class="section-header">
                    <h3>สรุปยอดขาย</h3>
                    <div class="date-filter">
                        <select id="salesPeriod" class="form-control" style="width: 200px;">
                            <option value="today">วันนี้</option>
                            <option value="week">สัปดาห์นี้</option>
                            <option value="month">เดือนนี้</option>
                            <option value="year">ปีนี้</option>
                            <option value="custom">กำหนดเอง</option>
                        </select>
                    </div>
                </div>
                
                <div class="stats-container">
                    <div class="stat-card">
                        <div class="stat-label">ยอดขายรวม</div>
                        <div class="stat-value" id="totalSales">0 ฿</div>
                        <div class="stat-label" id="totalSalesCount">0 รายการ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">เงินสด</div>
                        <div class="stat-value" id="cashSales">0 ฿</div>
                        <div class="stat-label" id="cashSalesCount">0 รายการ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">พร้อมเพย์</div>
                        <div class="stat-value" id="promptpaySales">0 ฿</div>
                        <div class="stat-label" id="promptpaySalesCount">0 รายการ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">กำไรสุทธิ</div>
                        <div class="stat-value" id="netProfit">0 ฿</div>
                        <div class="stat-label" id="profitMargin">0%</div>
                    </div>
                </div>
                
                <div class="profit-section">
                    <h4>สรุปกำไร</h4>
                    <div class="profit-row">
                        <span class="profit-label">ยอดขายรวม:</span>
                        <span class="profit-value" id="profitTotalSales">0 ฿</span>
                    </div>
                    <div class="profit-row">
                        <span class="profit-label">ต้นทุนรวม:</span>
                        <span class="profit-value" id="profitTotalCost">0 ฿</span>
                    </div>
                    <div class="profit-row">
                        <span class="profit-label">กำไรขั้นต้น:</span>
                        <span class="profit-value profit-positive" id="profitGross">0 ฿</span>
                    </div>
                    <div class="profit-row">
                        <span class="profit-label">ส่วนลดรวม:</span>
                        <span class="profit-value" id="profitTotalDiscount">0 ฿</span>
                    </div>
                    <div class="profit-row">
                        <span class="profit-label">กำไรสุทธิ:</span>
                        <span class="profit-value profit-positive" id="profitNet">0 ฿</span>
                    </div>
                </div>
                
                <div class="table-container">
                    <table id="salesTable">
                        <thead>
                            <tr>
                                <th>วันที่</th>
                                <th>รหัสการขาย</th>
                                <th>จำนวนสินค้า</th>
                                <th>ยอดรวม</th>
                                <th>ส่วนลด</th>
                                <th>ยอดสุทธิ</th>
                                <th>กำไร</th>
                                <th>วิธีการชำระ</th>
                                <th>ผู้ขาย</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Sales records will be loaded here by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Users Management Screen -->
            <div class="management-screen" id="usersScreen">
                <div class="section-header">
                    <h3>จัดการผู้ใช้</h3>
                    <button class="btn btn-primary" id="addUserBtn">
                        <i class="fas fa-user-plus"></i> เพิ่มผู้ใช้
                    </button>
                </div>
                
                <div class="table-container">
                    <table id="usersTable">
                        <thead>
                            <tr>
                                <th>ชื่อผู้ใช้</th>
                                <th>ชื่อ-นามสกุล</th>
                                <th>บทบาท</th>
                                <th>วันที่สร้าง</th>
                                <th>สถานะ</th>
                                <th>การจัดการ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Users will be loaded here by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Members Management Screen -->
            <div class="management-screen" id="membersScreen">
                <div class="section-header">
                    <h3>จัดการสมาชิก</h3>
                    <button class="btn btn-primary" id="addMemberBtn">
                        <i class="fas fa-user-plus"></i> เพิ่มสมาชิก
                    </button>
                </div>
                
                <div class="table-container">
                    <table id="membersTable">
                        <thead>
                            <tr>
                                <th>รหัสสมาชิก</th>
                                <th>ชื่อ-นามสกุล</th>
                                <th>เบอร์โทร</th>
                                <th>ส่วนลด</th>
                                <th>คะแนน</th>
                                <th>วันที่สมัคร</th>
                                <th>การจัดการ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Members will be loaded here by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Discount Codes Management Screen -->
            <div class="management-screen" id="discountCodesScreen">
                <div class="section-header">
                    <h3>จัดการโค้ดส่วนลด</h3>
                    <button class="btn btn-primary" id="addDiscountCodeBtn">
                        <i class="fas fa-plus"></i> เพิ่มโค้ดส่วนลด
                    </button>
                </div>
                
                <div class="table-container">
                    <table id="discountCodesTable">
                        <thead>
                            <tr>
                                <th>รหัส</th>
                                <th>ส่วนลด</th>
                                <th>ประเภท</th>
                                <th>ยอดขั้นต่ำ</th>
                                <th>จำนวนที่ใช้</th>
                                <th>วันที่สร้าง</th>
                                <th>วันที่หมดอายุ</th>
                                <th>สถานะ</th>
                                <th>การจัดการ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Discount codes will be loaded here by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- QR Management Screen -->
            <div class="management-screen" id="qrScreen">
                <div class="section-header">
                    <h3>จัดการ QR พร้อมเพย์</h3>
                    <button class="btn btn-primary" id="addQrBtn">
                        <i class="fas fa-plus"></i> เพิ่ม QR
                    </button>
                </div>
                
                <div class="table-container">
                    <table id="qrTable">
                        <thead>
                            <tr>
                                <th>ชื่อ</th>
                                <th>เบอร์โทร</th>
                                <th>QR Code</th>
                                <th>สถานะ</th>
                                <th>การจัดการ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- QR Codes will be loaded here by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Logs Screen -->
            <div class="management-screen" id="logsScreen">
                <div class="section-header">
                    <h3>ประวัติการขาย</h3>
                </div>
                
                <div class="logs-container" id="logsContainer">
                    <!-- Logs will be loaded here by JavaScript -->
                </div>
            </div>
            
            <!-- Settings Screen -->
            <div class="management-screen" id="settingsScreen">
                <div class="section-header">
                    <h3>การตั้งค่าร้าน</h3>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="shopName">ชื่อร้าน</label>
                        <input type="text" id="shopName" class="form-control" value="Startosphere">
                    </div>
                    <div class="form-group">
                        <label for="shopPhone">เบอร์โทรร้าน</label>
                        <input type="text" id="shopPhone" class="form-control" value="0988722639">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="shopAddress">ที่อยู่ร้าน</label>
                    <input type="text" id="shopAddress" class="form-control" value="ระยอง">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="openTime">เวลาเปิดร้าน</label>
                        <input type="time" id="openTime" class="form-control" value="08:00">
                    </div>
                    <div class="form-group">
                        <label for="closeTime">เวลาปิดร้าน</label>
                        <input type="time" id="closeTime" class="form-control" value="20:00">
                    </div>
                </div>
                
                <div class="action-buttons" style="margin-top: 30px;">
                    <button class="btn btn-primary" id="saveSettingsBtn">
                        <i class="fas fa-save"></i> บันทึกการตั้งค่า
                    </button>
                    <button class="btn btn-secondary" id="backupDataBtn">
                        <i class="fas fa-download"></i> สำรองข้อมูล
                    </button>
                    <button class="btn btn-warning" id="restoreDataBtn">
                        <i class="fas fa-upload"></i> กู้คืนข้อมูล
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Product Modal -->
    <div class="modal" id="productModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="productModalTitle">เพิ่มสินค้าใหม่</h3>
                <button class="modal-close" id="closeProductModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="modalProductName">ชื่อสินค้า</label>
                    <input type="text" id="modalProductName" class="form-control" placeholder="กรอกชื่อสินค้า">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="modalProductPrice">ราคาขาย (บาท)</label>
                        <input type="number" id="modalProductPrice" class="form-control" placeholder="0.00" min="0" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="modalProductCost">ต้นทุน (บาท)</label>
                        <input type="number" id="modalProductCost" class="form-control" placeholder="0.00" min="0" step="0.01">
                    </div>
                </div>
                <div class="form-group">
                    <label for="modalProductCategory">หมวดหมู่</label>
                    <select id="modalProductCategory" class="form-control">
                        <option value="เครื่องดื่ม">เครื่องดื่ม</option>
                        <option value="อาหาร">อาหาร</option>
                        <option value="ขนม">ขนม</option>
                        <option value="อื่นๆ">อื่นๆ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="modalProductStock">จำนวนสต็อก</label>
                    <input type="number" id="modalProductStock" class="form-control" placeholder="0" min="0">
                </div>
                <div class="form-group">
                    <label for="modalProductLowStock">แจ้งเตือนเมื่อสต็อกต่ำกว่า</label>
                    <input type="number" id="modalProductLowStock" class="form-control" placeholder="5" min="1" value="5">
                </div>
                <div class="form-group">
                    <label for="modalProductImage">รูปสินค้า (URL)</label>
                    <input type="text" id="modalProductImage" class="form-control" placeholder="https://example.com/image.jpg">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelProductModal">ยกเลิก</button>
                <button class="btn btn-primary" id="saveProductModal">บันทึก</button>
            </div>
        </div>
    </div>

    <!-- User Modal -->
    <div class="modal" id="userModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="userModalTitle">เพิ่มผู้ใช้ใหม่</h3>
                <button class="modal-close" id="closeUserModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="modalUsername">ชื่อผู้ใช้</label>
                    <input type="text" id="modalUsername" class="form-control" placeholder="กรอกชื่อผู้ใช้">
                </div>
                <div class="form-group">
                    <label for="modalName">ชื่อ-นามสกุล</label>
                    <input type="text" id="modalName" class="form-control" placeholder="กรอกชื่อ-นามสกุล">
                </div>
                <div class="form-group">
                    <label for="modalRole">บทบาท</label>
                    <select id="modalRole" class="form-control">
                        <option value="staff">พนักงานขาย</option>
                        <option value="manager">ผู้จัดการ</option>
                        <option value="admin">ผู้ดูแลระบบ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="modalPassword">รหัสผ่าน</label>
                    <input type="password" id="modalPassword" class="form-control" placeholder="กรอกรหัสผ่าน">
                </div>
                <div class="form-group">
                    <label for="modalConfirmPassword">ยืนยันรหัสผ่าน</label>
                    <input type="password" id="modalConfirmPassword" class="form-control" placeholder="กรอกรหัสผ่านอีกครั้ง">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelUserModal">ยกเลิก</button>
                    <button class="btn btn-primary" id="saveUserModal">บันทึก</button>
            </div>
        </div>
    </div>

    <!-- Member Modal -->
    <div class="modal" id="memberModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="memberModalTitle">เพิ่มสมาชิกใหม่</h3>
                <button class="modal-close" id="closeMemberModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="modalMemberName">ชื่อ-นามสกุล</label>
                    <input type="text" id="modalMemberName" class="form-control" placeholder="กรอกชื่อ-นามสกุล">
                </div>
                <div class="form-group">
                    <label for="modalMemberPhone">เบอร์โทร</label>
                    <input type="text" id="modalMemberPhone" class="form-control" placeholder="กรอกเบอร์โทร">
                </div>
                <div class="form-group">
                    <label for="modalMemberDiscount">ส่วนลด (%)</label>
                    <input type="number" id="modalMemberDiscount" class="form-control" placeholder="5" min="0" max="100" value="5">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelMemberModal">ยกเลิก</button>
                <button class="btn btn-primary" id="saveMemberModal">บันทึก</button>
            </div>
        </div>
    </div>

    <!-- Discount Code Modal -->
    <div class="modal" id="discountCodeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="discountCodeModalTitle">เพิ่มโค้ดส่วนลด</h3>
                <button class="modal-close" id="closeDiscountCodeModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="modalDiscountCode">รหัสส่วนลด</label>
                    <input type="text" id="modalDiscountCode" class="form-control" placeholder="กรอกรหัสส่วนลด">
                </div>
                <div class="form-group">
                    <label for="modalDiscountValue">ส่วนลด</label>
                    <input type="number" id="modalDiscountValue" class="form-control" placeholder="0" min="0">
                </div>
                <div class="form-group">
                    <label for="modalDiscountType">ประเภทส่วนลด</label>
                    <select id="modalDiscountType" class="form-control">
                        <option value="percent">เปอร์เซ็นต์ (%)</option>
                        <option value="fixed">จำนวนเงิน (บาท)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="modalDiscountMinAmount">ยอดขั้นต่ำ (บาท)</label>
                    <input type="number" id="modalDiscountMinAmount" class="form-control" placeholder="0" min="0" value="0">
                </div>
                <div class="form-group">
                    <label for="modalDiscountMaxUses">จำนวนครั้งที่ใช้ได้สูงสุด</label>
                    <input type="number" id="modalDiscountMaxUses" class="form-control" placeholder="ไม่จำกัด" min="0">
                </div>
                <div class="form-group">
                    <label for="modalDiscountExpiryDate">วันที่หมดอายุ</label>
                    <input type="date" id="modalDiscountExpiryDate" class="form-control">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelDiscountCodeModal">ยกเลิก</button>
                <button class="btn btn-primary" id="saveDiscountCodeModal">บันทึก</button>
            </div>
        </div>
    </div>

    <!-- Redeem Points Modal -->
    <div class="modal" id="redeemPointsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>แลกคะแนน</h3>
                <button class="modal-close" id="closeRedeemPointsModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>คะแนนที่มี: <span id="availablePoints">0</span> คะแนน</label>
                </div>
                <div class="form-group">
                    <label for="redeemPointsAmount">จำนวนคะแนนที่จะแลก</label>
                    <input type="range" id="redeemPointsAmount" class="range-slider" min="0" max="1000" step="10" value="0">
                    <div class="range-value" id="redeemPointsValue">0 คะแนน</div>
                </div>
                <div class="form-group">
                    <label>ส่วนลดที่ได้รับ: <span id="redeemDiscountAmount">0</span> บาท</label>
                </div>
                <div class="form-group">
                    <label>คะแนนคงเหลือ: <span id="remainingPoints">0</span> คะแนน</label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelRedeemPoints">ยกเลิก</button>
                <button class="btn btn-primary" id="confirmRedeemPoints">แลกคะแนน</button>
            </div>
        </div>
    </div>

    <!-- QR Payment Modal -->
    <div class="modal" id="qrPaymentModal">
        <div class="modal-content qr-modal">
            <div class="modal-header">
                <h3>ชำระเงินผ่านพร้อมเพย์</h3>
                <button class="modal-close" id="closeQrPaymentModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="qr-container">
                    <div class="payment-timer" id="paymentTimer">05:00</div>
                    <div class="qr-code">
                        <img id="qrImage" src="" alt="QR Code" style="display: none;">
                        <div id="qrLoading" style="display: none; text-align: center; padding: 50px;">
                            <i class="fas fa-spinner fa-spin fa-3x" style="color: var(--primary);"></i>
                            <p style="margin-top: 20px;">กำลังสร้าง QR Code...</p>
                        </div>
                    </div>
                    <div class="payment-details">
                        <h4>รายละเอียดการชำระเงิน</h4>
                        <p>จำนวนเงิน: <strong id="qrAmount">0.00 ฿</strong></p>
                        <p>หมายเลขพร้อมเพย์: <strong id="promptpayNumberDisplay">0988722639</strong></p>
                        <p>ชื่อร้าน: <strong id="shopNameDisplay">สิรวิชญ์ สินบุญ</strong></p>
                        <div class="qr-warning">
                            <i class="fas fa-exclamation-triangle"></i>
                            ตรวจสอบชื่อก่อนชำระเงิน ชื่อ สิรวิชญ์ สินบุญ
                        </div>
                        <p style="margin-top: 10px; font-size: 0.9rem;">⚠️ กรุณาชำระเงินภายใน 5 นาที</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelQrPayment">ยกเลิก</button>
                <button class="btn btn-success" id="confirmQrPayment">ยืนยันการชำระเงิน</button>
            </div>
        </div>
    </div>

    <!-- Backup Modal -->
    <div class="modal" id="backupModal">
        <div class="modal-content backup-modal">
            <div class="modal-header">
                <h3>สำรองข้อมูล</h3>
                <button class="modal-close" id="closeBackupModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="backupPassword">รหัสผ่านสำรองข้อมูล</label>
                    <input type="password" id="backupPassword" class="form-control" placeholder="กรอกรหัสผ่าน">
                </div>
                <div class="backup-actions">
                    <button class="btn btn-secondary" id="cancelBackup">ยกเลิก</button>
                    <button class="btn btn-primary" id="confirmBackup">สำรองข้อมูล</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Restore Modal -->
    <div class="modal" id="restoreModal">
        <div class="modal-content backup-modal">
            <div class="modal-header">
                <h3>กู้คืนข้อมูล</h3>
                <button class="modal-close" id="closeRestoreModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="restorePassword">รหัสผ่านกู้คืน</label>
                    <input type="password" id="restorePassword" class="form-control" placeholder="กรอกรหัสผ่าน">
                </div>
                <div class="form-group">
                    <label for="backupFile">ไฟล์ข้อมูล</label>
                    <input type="file" id="backupFile" class="form-control" accept=".json">
                </div>
                <div class="backup-actions">
                    <button class="btn btn-secondary" id="cancelRestore">ยกเลิก</button>
                    <button class="btn btn-primary" id="confirmRestore">กู้คืนข้อมูล</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notificationText">ดำเนินการเสร็จสิ้น</span>
    </div>

    <script>
        // ข้อมูลตัวอย่าง
        const sampleData = {
            products: [
                { id: 1, name: "น้ำดื่ม", price: 10, cost: 5, image: "https://via.placeholder.com/80x80?text=น้ำดื่ม", category: "เครื่องดื่ม", stock: 50, lowStock: 10 },
                { id: 2, name: "ขนมปัง", price: 25, cost: 15, image: "https://via.placeholder.com/80x80?text=ขนมปัง", category: "อาหาร", stock: 30, lowStock: 5 },
                { id: 3, name: "นม UHT", price: 15, cost: 10, image: "https://via.placeholder.com/80x80?text=นม+UHT", category: "เครื่องดื่ม", stock: 40, lowStock: 10 },
                { id: 4, name: "กาแฟ", price: 35, cost: 20, image: "https://via.placeholder.com/80x80?text=กาแฟ", category: "เครื่องดื่ม", stock: 20, lowStock: 5 },
                { id: 5, name: "บะหมี่กึ่งสำเร็จรูป", price: 8, cost: 5, image: "https://via.placeholder.com/80x80?text=บะหมี่", category: "อาหาร", stock: 60, lowStock: 10 },
                { id: 6, name: "น้ำอัดลม", price: 20, cost: 12, image: "https://via.placeholder.com/80x80?text=น้ำอัดลม", category: "เครื่องดื่ม", stock: 35, lowStock: 5 },
                { id: 7, name: "ช็อกโกแลต", price: 15, cost: 8, image: "https://via.placeholder.com/80x80?text=ช็อกโกแลต", category: "ขนม", stock: 25, lowStock: 5 },
                { id: 8, name: "มันฝรั่งทอด", price: 20, cost: 12, image: "https://via.placeholder.com/80x80?text=มันฝรั่งทอด", category: "ขนม", stock: 30, lowStock: 5 },
                { id: 9, name: "ลูกอม", price: 5, cost: 2, image: "https://via.placeholder.com/80x80?text=ลูกอม", category: "ขนม", stock: 100, lowStock: 20 },
                { id: 10, name: "น้ำผลไม้", price: 25, cost: 15, image: "https://via.placeholder.com/80x80?text=น้ำผลไม้", category: "เครื่องดื่ม", stock: 15, lowStock: 5 },
                { id: 11, name: "ข้าวกล่อง", price: 45, cost: 25, image: "https://via.placeholder.com/80x80?text=ข้าวกล่อง", category: "อาหาร", stock: 10, lowStock: 3 },
                { id: 12, name: "ซาลาเปา", price: 20, cost: 10, image: "https://via.placeholder.com/80x80?text=ซาลาเปา", category: "อาหาร", stock: 0, lowStock: 5 }
            ],
            categories: ["ทั้งหมด", "เครื่องดื่ม", "อาหาร", "ขนม"],
            users: [],
            sales: [
                { id: "S001", date: "2023-10-01", items: 3, total: 65, cost: 35, profit: 30, payment: "cash", user: "พนักงาน", discount: 0, finalTotal: 65 },
                { id: "S002", date: "2023-10-01", items: 2, total: 40, cost: 22, profit: 18, payment: "cash", user: "พนักงาน", discount: 0, finalTotal: 40 },
                { id: "S003", date: "2023-10-02", items: 5, total: 95, cost: 52, profit: 43, payment: "promptpay", user: "แอดมิน", discount: 5, finalTotal: 90 },
                { id: "S004", date: "2023-10-02", items: 1, total: 15, cost: 10, profit: 5, payment: "cash", user: "พนักงาน", discount: 0, finalTotal: 15 }
            ],
            settings: {
                shopName: "Startosphere",
                shopPhone: "0988722639",
                shopAddress: "ระยอง",
                openTime: "08:00",
                closeTime: "20:00",
                shopLogo: ""
            },
            members: [
                { id: 1, code: "M001", name: "สมชาย ใจดี", phone: "089-111-1111", discount: 5, points: 100, created: "2023-01-15" },
                { id: 2, code: "M002", name: "สมหญิง รักดี", phone: "089-222-2222", discount: 10, points: 200, created: "2023-02-20" },
                { id: 3, code: "M003", name: "สมปอง ตั้งใจ", phone: "089-333-3333", discount: 15, points: 300, created: "2023-03-10" }
            ],
            discountCodes: [
                { id: 1, code: "SAVE10", discount: 10, type: "percent", minAmount: 100, maxUses: 100, usedCount: 5, expiryDate: "2023-12-31", active: true },
                { id: 2, code: "SAVE50", discount: 50, type: "fixed", minAmount: 200, maxUses: 50, usedCount: 2, expiryDate: "2023-11-30", active: true },
                { id: 3, code: "WELCOME", discount: 20, type: "percent", minAmount: 0, maxUses: null, usedCount: 10, expiryDate: null, active: true }
            ],
            qrCodes: [
                { id: 1, name: "พร้อมเพย์หลัก", phone: "0988722639", image: "", active: true }
            ],
            logs: [
                { id: 1, action: "ขายสินค้า", user: "พนักงาน", details: "ขายสินค้า S001 จำนวน 65 บาท", timestamp: "2023-10-01 10:30:00" },
                { id: 2, action: "เพิ่มสินค้า", user: "แอดมิน", details: "เพิ่มสินค้า 'น้ำดื่ม'", timestamp: "2023-10-01 11:15:00" },
                { id: 3, action: "ขายสินค้า", user: "พนักงาน", details: "ขายสินค้า S002 จำนวน 40 บาท", timestamp: "2023-10-01 14:20:00" },
                { id: 4, action: "แก้ไขสินค้า", user: "แอดมิน", details: "แก้ไขราคาสินค้า 'กาแฟ' เป็น 35 บาท", timestamp: "2023-10-02 09:45:00" }
            ]
        };

        // ===================================================================
        // *** การตั้งค่าเบอร์โทรพร้อมเพย์: เปลี่ยนค่านี้เป็น PromptPay ID ของคุณ ***
        // ** ห้ามใส่เครื่องหมายขีดคั่น (-) **
        // ===================================================================
        const PROMPTPAY_ID = '0988722639';
        // ===================================================================

        // สถานะแอปพลิเคชัน
        let appState = {
            currentUser: null,
            cart: [],
            selectedPayment: 'cash',
            currentScreen: 'pos',
            products: [],
            categories: [],
            users: [],
            sales: [],
            settings: {},
            members: [],
            discountCodes: [],
            qrCodes: [],
            logs: [],
            editingProduct: null,
            editingUser: null,
            editingMember: null,
            editingDiscountCode: null,
            currentMember: null,
            currentDiscountCode: null,
            discountAmount: 0,
            qrTimer: null,
            pointsDiscount: 0
        };

        // โหลดข้อมูลจาก LocalStorage หรือใช้ข้อมูลตัวอย่าง
        function loadAppData() {
            console.log('Loading data from localStorage...');
            
            // พยายามโหลดจาก localStorage
            try {
                const savedData = localStorage.getItem('posData');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    
                    appState.products = data.products || sampleData.products;
                    appState.categories = data.categories || sampleData.categories;
                    appState.users = data.users || sampleData.users;
                    appState.sales = data.sales || sampleData.sales;
                    appState.settings = data.settings || sampleData.settings;
                    appState.members = data.members || sampleData.members;
                    appState.discountCodes = data.discountCodes || sampleData.discountCodes;
                    appState.qrCodes = data.qrCodes || sampleData.qrCodes;
                    appState.logs = data.logs || sampleData.logs;
                    
                    console.log('Data loaded from localStorage');
                } else {
                    loadSampleData();
                    console.log('No saved data, loading sample data');
                }
            } catch (error) {
                console.error('Error loading data from localStorage:', error);
                loadSampleData();
            }
            
            // อัพเดท QR Codes ด้วยเบอร์โทรพร้อมเพย์ที่ตั้งค่า
            if (appState.qrCodes.length > 0) {
                appState.qrCodes[0].phone = PROMPTPAY_ID;
            }
        }

        // ฟังก์ชันโหลดข้อมูลตัวอย่าง
        function loadSampleData() {
            console.log('Loading sample data...');
            appState.products = sampleData.products;
            appState.categories = sampleData.categories;
            appState.users = sampleData.users;
            appState.sales = sampleData.sales;
            appState.settings = sampleData.settings;
            appState.members = sampleData.members;
            appState.discountCodes = sampleData.discountCodes;
            
            // อัพเดท QR Codes ด้วยเบอร์โทรพร้อมเพย์ที่ตั้งค่า
            const qrCodesData = sampleData.qrCodes;
            if (qrCodesData.length > 0) {
                qrCodesData[0].phone = PROMPTPAY_ID;
            }
            appState.qrCodes = qrCodesData;
            
            appState.logs = sampleData.logs;
        }

        // บันทึกข้อมูลลง LocalStorage
        function saveAppData() {
            console.log('Saving data to localStorage...');
            
            const dataToSave = {
                products: appState.products,
                users: appState.users,
                logs: appState.logs,
                sales: appState.sales,
                members: appState.members,
                discountCodes: appState.discountCodes,
                qrCodes: appState.qrCodes,
                settings: appState.settings,
                lastSaved: new Date().toISOString()
            };

            try {
                localStorage.setItem('posData', JSON.stringify(dataToSave));
                console.log('Data saved to localStorage');
            } catch (error) {
                console.error('Error saving data to localStorage:', error);
                showNotification('บันทึกข้อมูลล้มเหลว', 'error');
            }
        }

        // แสดงการแจ้งเตือน
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            
            notificationText.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // อัพเดทเวลาปัจจุบัน
        function updateCurrentTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('th-TH');
            const dateString = now.toLocaleDateString('th-TH', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            document.getElementById('currentTime').textContent = `${dateString} ${timeString}`;
        }

        // ระบบล็อกอินที่แก้ไขแล้ว
        function setupLogin() {
            document.getElementById('loginBtn').addEventListener('click', function() {
                const password = document.getElementById('password').value.trim();
                const loginError = document.getElementById('loginError');
                
                if (!password) {
                    loginError.textContent = 'กรุณากรอกรหัสผ่าน';
                    loginError.classList.add('show');
                    return;
                }
                
                let userRole = '';
                let userName = '';
                
                // ตรวจสอบรหัสผ่าน
                if (password === '101617') {
                    userRole = 'admin';
                    userName = 'แอดมิน';
                } else if (password === '123456') {
                    userRole = 'staff';
                    userName = 'พนักงาน';
                } else {
                    loginError.textContent = 'รหัสผ่านไม่ถูกต้อง';
                    loginError.classList.add('show');
                    return;
                }
                
                // สร้างข้อมูลผู้ใช้
                appState.currentUser = {
                    username: userRole,
                    name: userName,
                    role: userRole
                };
                
                // ซ่อนหน้าล็อกอินและแสดงแอปพลิเคชัน
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('appContainer').style.display = 'flex';
                
                // อัพเดทข้อมูลผู้ใช้
                document.getElementById('userName').innerHTML = `${userName} <span class="role-indicator ${userRole === 'admin' ? 'role-admin' : 'role-staff'}">${userRole === 'admin' ? 'แอดมิน' : 'พนักงาน'}</span>`;
                document.getElementById('userAvatar').textContent = userName.charAt(0);
                
                showNotification(`ยินดีต้อนรับ ${userName}`);
                
                // โหลดข้อมูลและเริ่มต้นแอป
                initializeApp();
            });

            // อนุญาตให้กด Enter เพื่อล็อกอิน
            document.getElementById('password').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    document.getElementById('loginBtn').click();
                }
            });

            // ล้าง error เมื่อผู้ใช้เริ่มพิมพ์
            document.getElementById('password').addEventListener('input', function() {
                document.getElementById('loginError').classList.remove('show');
            });
        }

        // เริ่มต้นแอปพลิเคชัน
        function initializeApp() {
            setupNavigation();
            setupPOS();
            setupProductsManagement();
            setupSalesReport();
            setupUsersManagement();
            setupMembersManagement();
            setupDiscountCodesManagement();
            setupQrManagement();
            setupLogs();
            setupSettings();
            setupModals();
            
            // อัพเดทเวลาปัจจุบันทุกวินาที
            setInterval(updateCurrentTime, 1000);
            updateCurrentTime();
        }

        // ตั้งค่าการนำทาง
        function setupNavigation() {
            const navItems = document.querySelectorAll('.nav-item');
            
            navItems.forEach(item => {
                if (item.id !== 'logoutBtn') {
                    item.addEventListener('click', function() {
                        const screen = this.getAttribute('data-screen');
                        
                        // อัพเดทสถานะการเลือกในเมนู
                        navItems.forEach(nav => nav.classList.remove('active'));
                        this.classList.add('active');
                        
                        // แสดงหน้าจอที่เลือก
                        showScreen(screen);
                    });
                }
            });
            
            // ปุ่มออกจากระบบ
            document.getElementById('logoutBtn').addEventListener('click', function() {
                appState.currentUser = null;
                document.getElementById('loginScreen').style.display = 'flex';
                document.getElementById('appContainer').style.display = 'none';
                document.getElementById('password').value = '';
                document.getElementById('loginError').classList.remove('show');
            });
        }

        // แสดงหน้าจอที่เลือก
        function showScreen(screenName) {
            // ซ่อนหน้าจอทั้งหมด
            const screens = document.querySelectorAll('.management-screen');
            screens.forEach(screen => screen.classList.remove('active'));
            
            // แสดงหน้าจอที่เลือก
            document.getElementById(`${screenName}Screen`).classList.add('active');
            
            // อัพเดทชื่อหน้าจอ
            const screenTitles = {
                'pos': 'หน้าขาย (POS)',
                'products': 'จัดการสินค้า',
                'sales': 'สรุปยอดขาย',
                'users': 'ระบบผู้ใช้',
                'members': 'สมาชิก',
                'discountCodes': 'โค้ดส่วนลด',
                'qr': 'QR พร้อมเพย์',
                'logs': 'ประวัติการขาย',
                'settings': 'การตั้งค่า'
            };
            
            document.getElementById('screenTitle').textContent = screenTitles[screenName];
            appState.currentScreen = screenName;
            
            // ตรวจสอบสิทธิ์การเข้าถึง
            checkPermissions();
            
            // โหลดข้อมูลเฉพาะหน้าจอ
            if (screenName === 'products') {
                renderProductsTable();
            } else if (screenName === 'sales') {
                renderSalesReport();
            } else if (screenName === 'users') {
                renderUsersTable();
            } else if (screenName === 'members') {
                renderMembersTable();
            } else if (screenName === 'discountCodes') {
                renderDiscountCodesTable();
            } else if (screenName === 'qr') {
                renderQrTable();
            } else if (screenName === 'logs') {
                renderLogs();
            } else if (screenName === 'settings') {
                loadSettings();
            }
        }

        // ตรวจสอบสิทธิ์การเข้าถึง
        function checkPermissions() {
            const userRole = appState.currentUser.role;
            
            // ซ่อนเมนูที่ไม่จำเป็นสำหรับ staff
            if (userRole === 'staff') {
                document.getElementById('productsNav').style.display = 'none';
                document.getElementById('usersNav').style.display = 'none';
                document.getElementById('membersNav').style.display = 'none';
                document.getElementById('discountCodesNav').style.display = 'none';
                document.getElementById('qrNav').style.display = 'none';
                document.getElementById('settingsNav').style.display = 'none';
            } else {
                // แสดงเมนูทั้งหมดสำหรับแอดมิน
                document.getElementById('productsNav').style.display = 'flex';
                document.getElementById('usersNav').style.display = 'flex';
                document.getElementById('membersNav').style.display = 'flex';
                document.getElementById('discountCodesNav').style.display = 'flex';
                document.getElementById('qrNav').style.display = 'flex';
                document.getElementById('settingsNav').style.display = 'flex';
            }
        }

        // ตั้งค่า POS
        function setupPOS() {
            renderCategories();
            renderProducts();
            setupCart();
            setupPayment();
            setupMemberSystem();
            setupDiscountSystem();
        }

        // เรนเดอร์หมวดหมู่
        function renderCategories() {
            const categoryTabs = document.getElementById('categoryTabs');
            categoryTabs.innerHTML = '';
            
            appState.categories.forEach(category => {
                const tab = document.createElement('div');
                tab.className = `category-tab ${category === 'ทั้งหมด' ? 'active' : ''}`;
                tab.textContent = category;
                tab.setAttribute('data-category', category);
                
                tab.addEventListener('click', function() {
                    // อัพเดทสถานะการเลือก
                    document.querySelectorAll('.category-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // กรองสินค้า
                    filterProductsByCategory(this.getAttribute('data-category'));
                });
                
                categoryTabs.appendChild(tab);
            });
        }

        // เรนเดอร์สินค้า
        function renderProducts(category = 'ทั้งหมด') {
            const productsGrid = document.getElementById('productsGrid');
            productsGrid.innerHTML = '';
            
            let filteredProducts = appState.products;
            
            if (category !== 'ทั้งหมด') {
                filteredProducts = appState.products.filter(product => product.category === category);
            }
            
            // กรองตามการค้นหา
            const searchTerm = document.getElementById('productSearch').value.toLowerCase();
            if (searchTerm) {
                filteredProducts = filteredProducts.filter(product => 
                    product.name.toLowerCase().includes(searchTerm)
                );
            }
            
            if (filteredProducts.length === 0) {
                productsGrid.innerHTML = '<p style="grid-column: 1 / -1; text-align: center; padding: 20px; color: var(--gray);">ไม่พบสินค้า</p>';
                return;
            }
            
            filteredProducts.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                
                if (product.stock === 0) {
                    productCard.classList.add('out-of-stock');
                } else if (product.stock <= product.lowStock) {
                    productCard.classList.add('low-stock');
                }
                
                productCard.innerHTML = `
                    ${product.stock === 0 ? '<div class="out-of-stock-badge">หมด</div>' : ''}
                    ${product.stock > 0 && product.stock <= product.lowStock ? '<div class="stock-badge">เหลือน้อย</div>' : ''}
                    <div class="product-image">
                        <img src="${product.image}" alt="${product.name}" onerror="this.src='https://via.placeholder.com/80x80?text=No+Image'">
                    </div>
                    <div class="product-name">${product.name}</div>
                    <div class="product-price">${product.price} ฿</div>
                    ${product.stock > 0 ? `<div style="font-size: 0.8rem; color: var(--gray); margin-top: 5px;">คงเหลือ: ${product.stock}</div>` : ''}
                `;
                
                if (product.stock > 0) {
                    productCard.addEventListener('click', () => addToCart(product));
                }
                
                productsGrid.appendChild(productCard);
            });
        }

        // กรองสินค้าตามหมวดหมู่
        function filterProductsByCategory(category) {
            renderProducts(category);
        }

        // ตั้งค่าการค้นหาสินค้า
        document.getElementById('productSearch').addEventListener('input', function() {
            const activeCategory = document.querySelector('.category-tab.active').getAttribute('data-category');
            renderProducts(activeCategory);
        });

        // ตั้งค่าตะกร้าสินค้า
        function setupCart() {
            updateCart();
            
            // ปุ่มล้างตะกร้า
            document.getElementById('clearCart').addEventListener('click', function() {
                appState.cart = [];
                appState.currentMember = null;
                appState.currentDiscountCode = null;
                appState.discountAmount = 0;
                appState.pointsDiscount = 0;
                updateCart();
                showNotification('ล้างรายการสินค้าแล้ว');
            });
            
            // ปุ่มขายสินค้า
            document.getElementById('completeSale').addEventListener('click', function() {
                if (appState.cart.length === 0) {
                    showNotification('กรุณาเลือกสินค้า', 'error');
                    return;
                }
                
                if (appState.selectedPayment === 'cash') {
                    const cashReceived = parseFloat(document.getElementById('cashReceived').value) || 0;
                    const total = calculateFinalTotal();
                    
                    if (cashReceived < total) {
                        showNotification('จำนวนเงินที่รับมาไม่เพียงพอ', 'error');
                        return;
                    }
                } else if (appState.selectedPayment === 'promptpay') {
                    showQrPaymentModal();
                    return;
                }
                
                completeSale();
            });
        }

        // แสดงโมดอล QR Payment
        function showQrPaymentModal() {
            const total = calculateFinalTotal();
            const shopName = "สิรวิชญ์ สินบุญ";
            
            // ตั้งค่าข้อมูลในโมดอล
            document.getElementById('qrAmount').textContent = `${total.toFixed(2)} ฿`;
            document.getElementById('promptpayNumberDisplay').textContent = PROMPTPAY_ID;
            document.getElementById('shopNameDisplay').textContent = shopName;
            
            // แสดงโมดอล
            document.getElementById('qrPaymentModal').classList.add('active');
            
            // สร้าง QR Code
            generateQRCode(total);
            
            // ตั้งเวลา 5 นาที
            let timeLeft = 5 * 60;
            appState.qrTimer = setInterval(() => {
                timeLeft--;
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                document.getElementById('paymentTimer').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                if (timeLeft <= 0) {
                    clearInterval(appState.qrTimer);
                    document.getElementById('qrPaymentModal').classList.remove('active');
                    showNotification('เวลาชำระเงินหมดแล้ว', 'error');
                }
            }, 1000);
        }

        // สร้าง QR Code
        function generateQRCode(amount) {
            const formattedAmount = amount.toFixed(2);
            
            // แสดง loading
            document.getElementById('qrImage').style.display = 'none';
            document.getElementById('qrLoading').style.display = 'block';
            
            // สร้าง URL สำหรับดึงรูปภาพ QR Code (ใช้บริการ PromptPay.io)
            const qrUrl = `https://promptpay.io/${PROMPTPAY_ID}/${formattedAmount}.png`;
            
            // โหลดรูปภาพ QR Code
            const qrImage = document.getElementById('qrImage');
            qrImage.onload = function() {
                document.getElementById('qrLoading').style.display = 'none';
                qrImage.style.display = 'inline-block';
            };
            qrImage.onerror = function() {
                document.getElementById('qrLoading').style.display = 'none';
                showNotification('ไม่สามารถสร้าง QR Code ได้', 'error');
            };
            qrImage.src = qrUrl;
            
            console.log("Generated QR URL:", qrUrl);
        }

        // ยืนยันการชำระเงิน QR
        document.getElementById('confirmQrPayment').addEventListener('click', function() {
            clearInterval(appState.qrTimer);
            document.getElementById('qrPaymentModal').classList.remove('active');
            completeSale();
        });

        // ยกเลิกการชำระเงิน QR
        document.getElementById('cancelQrPayment').addEventListener('click', function() {
            clearInterval(appState.qrTimer);
            document.getElementById('qrPaymentModal').classList.remove('active');
        });

        // ดำเนินการขาย
        function completeSale() {
            // บันทึกการขาย
            const sale = {
                id: 'S' + Date.now().toString().slice(-6),
                date: new Date().toISOString().split('T')[0],
                items: appState.cart.reduce((sum, item) => sum + item.quantity, 0),
                total: calculateTotal(),
                cost: calculateCost(),
                profit: calculateProfit(),
                discount: appState.discountAmount,
                finalTotal: calculateFinalTotal(),
                payment: appState.selectedPayment,
                user: appState.currentUser.name,
                cart: [...appState.cart],
                member: appState.currentMember ? appState.currentMember.code : null,
                discountCode: appState.currentDiscountCode ? appState.currentDiscountCode.code : null,
                pointsUsed: appState.pointsDiscount > 0 ? appState.pointsDiscount / 10 : 0
            };
            
            appState.sales.unshift(sale);
            
            // อัพเดทสต็อกสินค้า
            appState.cart.forEach(cartItem => {
                const product = appState.products.find(p => p.id === cartItem.id);
                if (product) {
                    product.stock -= cartItem.quantity;
                }
            });
            
            // อัพเดทคะแนนสมาชิก
            if (appState.currentMember) {
                // คำนวณคะแนนที่ได้รับ (1 คะแนนต่อ 10 บาท)
                const pointsEarned = Math.floor(sale.finalTotal / 10);
                appState.currentMember.points += pointsEarned;
                
                // ลบคะแนนที่ใช้ไป
                if (appState.pointsDiscount > 0) {
                    appState.currentMember.points -= appState.pointsDiscount / 10;
                }
                
                // อัพเดทข้อมูลสมาชิกในฐานข้อมูล
                const memberIndex = appState.members.findIndex(m => m.id === appState.currentMember.id);
                if (memberIndex !== -1) {
                    appState.members[memberIndex] = appState.currentMember;
                }
            }
            
            // อัพเดทจำนวนครั้งที่ใช้โค้ดส่วนลด
            if (appState.currentDiscountCode) {
                const discountCodeIndex = appState.discountCodes.findIndex(dc => dc.id === appState.currentDiscountCode.id);
                if (discountCodeIndex !== -1) {
                    appState.discountCodes[discountCodeIndex].usedCount += 1;
                }
            }
            
            // บันทึก Log
            addLog('ขายสินค้า', `ขายสินค้า ${sale.id} จำนวน ${sale.finalTotal} บาท (${appState.selectedPayment === 'cash' ? 'เงินสด' : 'พร้อมเพย์'})`);
            
            // บันทึกข้อมูล
            saveAppData();
            
            showNotification(`ขายสินค้าสำเร็จ! ยอดรวม: ${sale.finalTotal} ฿`);
            
            // รีเซ็ตสำหรับรอบต่อไป
            appState.cart = [];
            appState.currentMember = null;
            appState.currentDiscountCode = null;
            appState.discountAmount = 0;
            appState.pointsDiscount = 0;
            document.getElementById('cashReceived').value = '';
            updateCart();
            
            // อัพเดทหน้าจอสินค้า
            renderProducts();
        }

        // เพิ่มสินค้าในตะกร้า
        function addToCart(product) {
            const existingItem = appState.cart.find(item => item.id === product.id);
            
            if (existingItem) {
                if (existingItem.quantity >= product.stock) {
                    showNotification('สินค้าในสต็อกไม่เพียงพอ', 'warning');
                    return;
                }
                existingItem.quantity += 1;
            } else {
                if (product.stock < 1) {
                    showNotification('สินค้าหมด', 'error');
                    return;
                }
                appState.cart.push({
                    id: product.id,
                    name: product.name,
                    price: product.price,
                    cost: product.cost,
                    image: product.image,
                    quantity: 1
                });
            }
            
            updateCart();
            showNotification(`เพิ่ม ${product.name} ในตะกร้าแล้ว`);
        }

        // อัพเดทตะกร้าสินค้า
        function updateCart() {
            const cartItems = document.getElementById('cartItems');
            const subtotalElement = document.getElementById('subtotal');
            const totalElement = document.getElementById('total');
            const discountRow = document.getElementById('discountRow');
            const discountAmount = document.getElementById('discountAmount');
            
            cartItems.innerHTML = '';
            
            if (appState.cart.length === 0) {
                cartItems.innerHTML = '<p style="text-align: center; color: var(--gray); padding: 20px;">ไม่มีสินค้าในตะกร้า</p>';
                subtotalElement.textContent = '0.00 ฿';
                totalElement.textContent = '0.00 ฿';
                discountRow.style.display = 'none';
                document.getElementById('change').value = '0.00';
                return;
            }
            
            let subtotal = 0;
            
            appState.cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                subtotal += itemTotal;
                
                const cartItem = document.createElement('div');
                cartItem.className = 'cart-item fade-in';
                cartItem.innerHTML = `
                    <div class="item-info">
                        <div class="item-name">${item.name}</div>
                        <div class="item-price">${item.price} ฿/ชิ้น</div>
                    </div>
                    <div class="quantity-controls">
                        <button class="quantity-btn decrease" data-id="${item.id}">
                            <i class="fas fa-minus"></i>
                        </button>
                        <span class="quantity">${item.quantity}</span>
                        <button class="quantity-btn increase" data-id="${item.id}">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                    <div class="item-total">${itemTotal} ฿</div>
                    <div class="remove-item" data-id="${item.id}">
                        <i class="fas fa-times"></i>
                    </div>
                `;
                cartItems.appendChild(cartItem);
            });
            
            subtotalElement.textContent = `${subtotal.toFixed(2)} ฿`;
            
            // คำนวณส่วนลด
            calculateDiscount(subtotal);
            
            const finalTotal = calculateFinalTotal();
            totalElement.textContent = `${finalTotal.toFixed(2)} ฿`;
            
            if (appState.discountAmount > 0) {
                discountRow.style.display = 'flex';
                discountAmount.textContent = `-${appState.discountAmount.toFixed(2)} ฿`;
            } else {
                discountRow.style.display = 'none';
            }
            
            // เพิ่ม Event Listeners สำหรับปุ่มในตะกร้า
            document.querySelectorAll('.decrease').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = parseInt(e.target.closest('.decrease').getAttribute('data-id'));
                    decreaseQuantity(id);
                });
            });
            
            document.querySelectorAll('.increase').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = parseInt(e.target.closest('.increase').getAttribute('data-id'));
                    increaseQuantity(id);
                });
            });
            
            document.querySelectorAll('.remove-item').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = parseInt(e.target.closest('.remove-item').getAttribute('data-id'));
                    removeFromCart(id);
                });
            });
            
            // อัพเดทการคำนวณเงินทอน
            calculateChange();
        }

        // เพิ่มจำนวนสินค้าในตะกร้า
        function increaseQuantity(id) {
            const item = appState.cart.find(item => item.id === id);
            const product = appState.products.find(p => p.id === id);
            
            if (item && product) {
                if (item.quantity >= product.stock) {
                    showNotification('สินค้าในสต็อกไม่เพียงพอ', 'warning');
                    return;
                }
                item.quantity += 1;
                updateCart();
            }
        }

        // ลดจำนวนสินค้าในตะกร้า
        function decreaseQuantity(id) {
            const itemIndex = appState.cart.findIndex(item => item.id === id);
            if (itemIndex !== -1) {
                if (appState.cart[itemIndex].quantity > 1) {
                    appState.cart[itemIndex].quantity -= 1;
                } else {
                    appState.cart.splice(itemIndex, 1);
                }
                updateCart();
            }
        }

        // ลบสินค้าออกจากตะกร้า
        function removeFromCart(id) {
            appState.cart = appState.cart.filter(item => item.id !== id);
            updateCart();
            showNotification('ลบสินค้าออกจากตะกร้าแล้ว');
        }

        // คำนวณยอดรวม
        function calculateTotal() {
            return appState.cart.reduce((total, item) => total + (item.price * item.quantity), 0);
        }

        // คำนวณต้นทุน
        function calculateCost() {
            return appState.cart.reduce((total, item) => total + (item.cost * item.quantity), 0);
        }

        // คำนวณกำไร
        function calculateProfit() {
            return calculateTotal() - calculateCost() - appState.discountAmount;
        }

        // คำนวณส่วนลด
        function calculateDiscount(subtotal) {
            let discount = 0;
            
            // ส่วนลดจากสมาชิก
            if (appState.currentMember) {
                discount += subtotal * (appState.currentMember.discount / 100);
            }
            
            // ส่วนลดจากโค้ด
            if (appState.currentDiscountCode) {
                if (appState.currentDiscountCode.type === 'percent') {
                    discount += subtotal * (appState.currentDiscountCode.discount / 100);
                } else {
                    discount += appState.currentDiscountCode.discount;
                }
            }
            
            // ส่วนลดจากคะแนน
            discount += appState.pointsDiscount;
            
            appState.discountAmount = discount;
        }

        // คำนวณยอดรวมหลังหักส่วนลด
        function calculateFinalTotal() {
            const total = calculateTotal();
            return Math.max(0, total - appState.discountAmount);
        }

        // ตั้งค่าการชำระเงิน
        function setupPayment() {
            const paymentButtons = document.querySelectorAll('.payment-btn');
            
            paymentButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    paymentButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    appState.selectedPayment = btn.getAttribute('data-method');
                    
                    // ซ่อน/แสดงช่องกรอกเงินสด
                    const cashInputGroup = document.getElementById('cashInputGroup');
                    if (appState.selectedPayment === 'cash') {
                        cashInputGroup.style.display = 'block';
                    } else {
                        cashInputGroup.style.display = 'none';
                        document.getElementById('cashReceived').value = '';
                        document.getElementById('change').value = '0.00';
                    }
                });
            });
            
            // การคำนวณเงินทอน
            document.getElementById('cashReceived').addEventListener('input', calculateChange);
        }

        // คำนวณเงินทอน
        function calculateChange() {
            const total = calculateFinalTotal();
            const cashReceived = parseFloat(document.getElementById('cashReceived').value) || 0;
            const change = cashReceived - total;
            
            if (change >= 0) {
                document.getElementById('change').value = change.toFixed(2);
            } else {
                document.getElementById('change').value = '0.00';
            }
        }

        // ตั้งค่าระบบสมาชิก
        function setupMemberSystem() {
            // การค้นหาสมาชิก
            document.getElementById('memberCode').addEventListener('input', function() {
                const searchTerm = this.value.trim();
                const memberResults = document.getElementById('memberResults');
                
                if (searchTerm.length < 2) {
                    memberResults.style.display = 'none';
                    return;
                }
                
                const filteredMembers = appState.members.filter(member => 
                    member.name.toLowerCase().includes(searchTerm.toLowerCase()) || 
                    member.code.toLowerCase().includes(searchTerm.toLowerCase())
                );
                
                memberResults.innerHTML = '';
                
                if (filteredMembers.length === 0) {
                    memberResults.innerHTML = '<div class="member-result">ไม่พบสมาชิก</div>';
                } else {
                    filteredMembers.forEach(member => {
                        const result = document.createElement('div');
                        result.className = 'member-result';
                        result.innerHTML = `
                            <div><strong>${member.name}</strong></div>
                            <div>รหัส: ${member.code} | ส่วนลด: ${member.discount}% | คะแนน: ${member.points}</div>
                        `;
                        result.addEventListener('click', () => {
                            selectMember(member);
                            memberResults.style.display = 'none';
                        });
                        memberResults.appendChild(result);
                    });
                }
                
                memberResults.style.display = 'block';
            });
            
            // ปุ่มใช้สมาชิก
            document.getElementById('applyMember').addEventListener('click', function() {
                const memberCode = document.getElementById('memberCode').value.trim();
                
                if (!memberCode) {
                    showNotification('กรุณากรอกรหัสสมาชิก', 'error');
                    return;
                }
                
                const member = appState.members.find(m => m.code === memberCode);
                
                if (member) {
                    selectMember(member);
                } else {
                    showNotification('ไม่พบรหัสสมาชิก', 'error');
                }
            });
            
            // ปุ่มแลกคะแนน
            document.getElementById('redeemPoints').addEventListener('click', function() {
                if (!appState.currentMember) {
                    showNotification('กรุณาเลือกสมาชิกก่อน', 'error');
                    return;
                }
                
                showRedeemPointsModal();
            });
            
            // ซ่อนผลการค้นหาเมื่อคลิกที่อื่น
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.member-search')) {
                    document.getElementById('memberResults').style.display = 'none';
                }
            });
        }

        // เลือกสมาชิก
        function selectMember(member) {
            appState.currentMember = member;
            document.getElementById('memberCode').value = member.code;
            document.getElementById('memberName').textContent = member.name;
            document.getElementById('memberDiscount').textContent = `${member.discount}%`;
            document.getElementById('memberPoints').textContent = member.points;
            document.getElementById('memberInfo').style.display = 'block';
            
            // เปิดใช้งานช่องกรอกโค้ดส่วนลด
            document.getElementById('discountCode').disabled = false;
            document.getElementById('applyDiscount').disabled = false;
            
            updateCart();
            showNotification(`ใช้สิทธิ์สมาชิก ${member.name} สำเร็จ`);
        }

        // แสดงโมดอลแลกคะแนน
        function showRedeemPointsModal() {
            const modal = document.getElementById('redeemPointsModal');
            const availablePoints = appState.currentMember.points;
            
            document.getElementById('availablePoints').textContent = availablePoints;
            document.getElementById('redeemPointsAmount').max = Math.min(availablePoints, 1000);
            document.getElementById('redeemPointsAmount').value = 0;
            document.getElementById('redeemPointsValue').textContent = '0 คะแนน';
            document.getElementById('redeemDiscountAmount').textContent = '0';
            document.getElementById('remainingPoints').textContent = availablePoints;
            
            modal.classList.add('active');
        }

        // ตั้งค่าระบบแลกคะแนน
        function setupRedeemPoints() {
            // การเปลี่ยนแปลงค่า slider
            document.getElementById('redeemPointsAmount').addEventListener('input', function() {
                const points = parseInt(this.value);
                const discount = points; // 1 คะแนน = 1 บาท
                const remainingPoints = appState.currentMember.points - points;
                
                document.getElementById('redeemPointsValue').textContent = `${points} คะแนน`;
                document.getElementById('redeemDiscountAmount').textContent = discount;
                document.getElementById('remainingPoints').textContent = remainingPoints;
            });
            
            // ยืนยันการแลกคะแนน
            document.getElementById('confirmRedeemPoints').addEventListener('click', function() {
                const points = parseInt(document.getElementById('redeemPointsAmount').value);
                
                if (points <= 0) {
                    showNotification('กรุณาเลือกจำนวนคะแนนที่จะแลก', 'error');
                    return;
                }
                
                if (points > appState.currentMember.points) {
                    showNotification('คะแนนไม่เพียงพอ', 'error');
                    return;
                }
                
                appState.pointsDiscount = points;
                document.getElementById('redeemPointsModal').classList.remove('active');
                updateCart();
                showNotification(`แลกคะแนน ${points} คะแนนสำเร็จ ได้รับส่วนลด ${points} บาท`);
            });
            
            // ยกเลิกการแลกคะแนน
            document.getElementById('cancelRedeemPoints').addEventListener('click', function() {
                document.getElementById('redeemPointsModal').classList.remove('active');
            });
        }

        // ตั้งค่าระบบโค้ดส่วนลด
        function setupDiscountSystem() {
            document.getElementById('applyDiscount').addEventListener('click', function() {
                const discountCode = document.getElementById('discountCode').value.trim();
                const codeInfo = document.getElementById('codeInfo');
                
                if (!discountCode) {
                    showNotification('กรุณากรอกรหัสส่วนลด', 'error');
                    return;
                }
                
                const code = appState.discountCodes.find(c => 
                    c.code === discountCode && 
                    c.active && 
                    (c.expiryDate === null || new Date(c.expiryDate) >= new Date()) &&
                    (c.maxUses === null || c.usedCount < c.maxUses)
                );
                
                if (code) {
                    appState.currentDiscountCode = code;
                    document.getElementById('codeName').textContent = code.code;
                    
                    if (code.type === 'percent') {
                        document.getElementById('codeDiscount').textContent = `${code.discount}%`;
                    } else {
                        document.getElementById('codeDiscount').textContent = `${code.discount} ฿`;
                    }
                    
                    codeInfo.style.display = 'block';
                    updateCart();
                    showNotification(`ใช้โค้ดส่วนลด ${code.code} สำเร็จ`);
                } else {
                    showNotification('โค้ดส่วนลดไม่ถูกต้องหรือหมดอายุ', 'error');
                }
            });
        }

        // ตั้งค่าการจัดการสินค้า
        function setupProductsManagement() {
            // ปุ่มเพิ่มสินค้า
            document.getElementById('addProductBtn').addEventListener('click', function() {
                showProductModal();
            });
            
            // เรนเดอร์ตารางสินค้า
            renderProductsTable();
        }

        // เรนเดอร์ตารางสินค้า
        function renderProductsTable() {
            const tableBody = document.querySelector('#productsTable tbody');
            tableBody.innerHTML = '';
            
            if (appState.products.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="9" style="text-align: center; padding: 20px; color: var(--gray);">ไม่มีสินค้า</td></tr>';
                return;
            }
            
            appState.products.forEach(product => {
                const row = document.createElement('tr');
                row.className = 'fade-in';
                
                let status = 'ปกติ';
                let statusClass = '';
                
                if (product.stock === 0) {
                    status = 'หมด';
                    statusClass = 'error';
                } else if (product.stock <= product.lowStock) {
                    status = 'เหลือน้อย';
                    statusClass = 'warning';
                }
                
                const profit = product.price - product.cost;
                const profitMargin = product.price > 0 ? ((profit / product.price) * 100).toFixed(1) : 0;
                
                row.innerHTML = `
                    <td><div style="width: 50px; height: 50px;"><img src="${product.image}" alt="${product.name}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 5px;" onerror="this.src='https://via.placeholder.com/50x50?text=No+Image'"></div></td>
                    <td>${product.name}</td>
                    <td>${product.category}</td>
                    <td>${product.price} ฿</td>
                    <td>${product.cost} ฿</td>
                    <td>${profit} ฿ (${profitMargin}%)</td>
                    <td>${product.stock}</td>
                    <td><span class="${statusClass}">${status}</span></td>
                    <td class="action-cell">
                        <button class="action-btn edit-btn" data-id="${product.id}">
                            <i class="fas fa-edit"></i> แก้ไข
                        </button>
                        <button class="action-btn delete-btn" data-id="${product.id}">
                            <i class="fas fa-trash"></i> ลบ
                        </button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // เพิ่ม Event Listeners สำหรับปุ่มจัดการ
            document.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = parseInt(e.target.closest('.edit-btn').getAttribute('data-id'));
                    editProduct(id);
                });
            });
            
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = parseInt(e.target.closest('.delete-btn').getAttribute('data-id'));
                    deleteProduct(id);
                });
            });
        }

        // ตั้งค่า Modal
        function setupModals() {
            // Product Modal
            const productModal = document.getElementById('productModal');
            const closeProductModal = document.getElementById('closeProductModal');
            const cancelProductModal = document.getElementById('cancelProductModal');
            const saveProductModal = document.getElementById('saveProductModal');
            
            closeProductModal.addEventListener('click', function() {
                productModal.classList.remove('active');
                appState.editingProduct = null;
            });
            
            cancelProductModal.addEventListener('click', function() {
                productModal.classList.remove('active');
                appState.editingProduct = null;
            });
            
            saveProductModal.addEventListener('click', function() {
                saveProduct();
            });
            
            // User Modal
            const userModal = document.getElementById('userModal');
            const closeUserModal = document.getElementById('closeUserModal');
            const cancelUserModal = document.getElementById('cancelUserModal');
            const saveUserModal = document.getElementById('saveUserModal');
            
            closeUserModal.addEventListener('click', function() {
                userModal.classList.remove('active');
                appState.editingUser = null;
            });
            
            cancelUserModal.addEventListener('click', function() {
                userModal.classList.remove('active');
                appState.editingUser = null;
            });
            
            saveUserModal.addEventListener('click', function() {
                saveUser();
            });
            
            // Member Modal
            const memberModal = document.getElementById('memberModal');
            const closeMemberModal = document.getElementById('closeMemberModal');
            const cancelMemberModal = document.getElementById('cancelMemberModal');
            const saveMemberModal = document.getElementById('saveMemberModal');
            
            closeMemberModal.addEventListener('click', function() {
                memberModal.classList.remove('active');
                appState.editingMember = null;
            });
            
            cancelMemberModal.addEventListener('click', function() {
                memberModal.classList.remove('active');
                appState.editingMember = null;
            });
            
            saveMemberModal.addEventListener('click', function() {
                saveMember();
            });
            
            // Discount Code Modal
            const discountCodeModal = document.getElementById('discountCodeModal');
            const closeDiscountCodeModal = document.getElementById('closeDiscountCodeModal');
            const cancelDiscountCodeModal = document.getElementById('cancelDiscountCodeModal');
            const saveDiscountCodeModal = document.getElementById('saveDiscountCodeModal');
            
            closeDiscountCodeModal.addEventListener('click', function() {
                discountCodeModal.classList.remove('active');
                appState.editingDiscountCode = null;
            });
            
            cancelDiscountCodeModal.addEventListener('click', function() {
                discountCodeModal.classList.remove('active');
                appState.editingDiscountCode = null;
            });
            
            saveDiscountCodeModal.addEventListener('click', function() {
                saveDiscountCode();
            });
            
            // Redeem Points Modal
            const redeemPointsModal = document.getElementById('redeemPointsModal');
            const closeRedeemPointsModal = document.getElementById('closeRedeemPointsModal');
            
            closeRedeemPointsModal.addEventListener('click', function() {
                redeemPointsModal.classList.remove('active');
            });
            
            // QR Payment Modal
            const qrPaymentModal = document.getElementById('qrPaymentModal');
            const closeQrPaymentModal = document.getElementById('closeQrPaymentModal');
            
            closeQrPaymentModal.addEventListener('click', function() {
                clearInterval(appState.qrTimer);
                qrPaymentModal.classList.remove('active');
            });
            
            // Backup Modal
            const backupModal = document.getElementById('backupModal');
            const closeBackupModal = document.getElementById('closeBackupModal');
            const cancelBackup = document.getElementById('cancelBackup');
            const confirmBackup = document.getElementById('confirmBackup');
            
            closeBackupModal.addEventListener('click', function() {
                backupModal.classList.remove('active');
            });
            
            cancelBackup.addEventListener('click', function() {
                backupModal.classList.remove('active');
            });
            
            confirmBackup.addEventListener('click', function() {
                backupData();
            });
            
            // Restore Modal
            const restoreModal = document.getElementById('restoreModal');
            const closeRestoreModal = document.getElementById('closeRestoreModal');
            const cancelRestore = document.getElementById('cancelRestore');
            const confirmRestore = document.getElementById('confirmRestore');
            
            closeRestoreModal.addEventListener('click', function() {
                restoreModal.classList.remove('active');
            });
            
            cancelRestore.addEventListener('click', function() {
                restoreModal.classList.remove('active');
            });
            
            confirmRestore.addEventListener('click', function() {
                restoreData();
            });
            
            // ปิด Modal เมื่อคลิกนอกพื้นที่
            window.addEventListener('click', function(event) {
                if (event.target === productModal) {
                    productModal.classList.remove('active');
                    appState.editingProduct = null;
                }
                if (event.target === userModal) {
                    userModal.classList.remove('active');
                    appState.editingUser = null;
                }
                if (event.target === memberModal) {
                    memberModal.classList.remove('active');
                    appState.editingMember = null;
                }
                if (event.target === discountCodeModal) {
                    discountCodeModal.classList.remove('active');
                    appState.editingDiscountCode = null;
                }
                if (event.target === redeemPointsModal) {
                    redeemPointsModal.classList.remove('active');
                }
                if (event.target === qrPaymentModal) {
                    clearInterval(appState.qrTimer);
                    qrPaymentModal.classList.remove('active');
                }
                if (event.target === backupModal) {
                    backupModal.classList.remove('active');
                }
                if (event.target === restoreModal) {
                    restoreModal.classList.remove('active');
                }
            });
            
            // ตั้งค่าระบบแลกคะแนน
            setupRedeemPoints();
        }

        // แสดง Modal สินค้า
        function showProductModal(product = null) {
            const modal = document.getElementById('productModal');
            const title = document.getElementById('productModalTitle');
            
            appState.editingProduct = product;
            
            if (product) {
                title.textContent = 'แก้ไขสินค้า';
                document.getElementById('modalProductName').value = product.name;
                document.getElementById('modalProductPrice').value = product.price;
                document.getElementById('modalProductCost').value = product.cost;
                document.getElementById('modalProductCategory').value = product.category;
                document.getElementById('modalProductStock').value = product.stock;
                document.getElementById('modalProductLowStock').value = product.lowStock;
                document.getElementById('modalProductImage').value = product.image;
            } else {
                title.textContent = 'เพิ่มสินค้าใหม่';
                document.getElementById('modalProductName').value = '';
                document.getElementById('modalProductPrice').value = '';
                document.getElementById('modalProductCost').value = '';
                document.getElementById('modalProductCategory').value = 'เครื่องดื่ม';
                document.getElementById('modalProductStock').value = '';
                document.getElementById('modalProductLowStock').value = '5';
                document.getElementById('modalProductImage').value = '';
            }
            
            modal.classList.add('active');
        }

        // บันทึกสินค้า
        function saveProduct() {
            const name = document.getElementById('modalProductName').value;
            const price = parseFloat(document.getElementById('modalProductPrice').value);
            const cost = parseFloat(document.getElementById('modalProductCost').value);
            const category = document.getElementById('modalProductCategory').value;
            const stock = parseInt(document.getElementById('modalProductStock').value);
            const lowStock = parseInt(document.getElementById('modalProductLowStock').value);
            const image = document.getElementById('modalProductImage').value || `https://via.placeholder.com/80x80?text=${name}`;
            
            if (!name || !price || isNaN(stock) || !cost) {
                showNotification('กรุณากรอกข้อมูลให้ครบถ้วน', 'error');
                return;
            }
            
            if (appState.editingProduct) {
                // แก้ไขสินค้า
                appState.editingProduct.name = name;
                appState.editingProduct.price = price;
                appState.editingProduct.cost = cost;
                appState.editingProduct.category = category;
                appState.editingProduct.stock = stock;
                appState.editingProduct.lowStock = lowStock;
                appState.editingProduct.image = image;
                
                showNotification('แก้ไขสินค้าเรียบร้อยแล้ว');
                addLog('แก้ไขสินค้า', `แก้ไขสินค้า '${name}'`);
            } else {
                // เพิ่มสินค้าใหม่
                const newProduct = {
                    id: Date.now(),
                    name: name,
                    price: price,
                    cost: cost,
                    category: category,
                    stock: stock,
                    lowStock: lowStock,
                    image: image
                };
                
                appState.products.push(newProduct);
                showNotification('เพิ่มสินค้าใหม่เรียบร้อยแล้ว');
                addLog('เพิ่มสินค้า', `เพิ่มสินค้า '${name}'`);
            }
            
            // บันทึกข้อมูลและอัพเดท UI
            saveAppData();
            renderProductsTable();
            document.getElementById('productModal').classList.remove('active');
            appState.editingProduct = null;
            
            // อัพเดทหน้าขายถ้าอยู่ในหน้าขาย
            if (appState.currentScreen === 'pos') {
                const activeCategory = document.querySelector('.category-tab.active').getAttribute('data-category');
                renderProducts(activeCategory);
            }
        }

        // แก้ไขสินค้า
        function editProduct(id) {
            const product = appState.products.find(p => p.id === id);
            if (product) {
                showProductModal(product);
            }
        }

        // ลบสินค้า
        function deleteProduct(id) {
            if (confirm('คุณแน่ใจว่าต้องการลบสินค้านี้?')) {
                const product = appState.products.find(p => p.id === id);
                appState.products = appState.products.filter(p => p.id !== id);
                saveAppData();
                renderProductsTable();
                
                // อัพเดทหน้าขายถ้าอยู่ในหน้าขาย
                if (appState.currentScreen === 'pos') {
                    const activeCategory = document.querySelector('.category-tab.active').getAttribute('data-category');
                    renderProducts(activeCategory);
                }
                
                showNotification('ลบสินค้าเรียบร้อยแล้ว');
                addLog('ลบสินค้า', `ลบสินค้า '${product.name}'`);
            }
        }

        // ตั้งค่าสรุปยอดขาย
        function setupSalesReport() {
            // ตั้งค่าตัวกรองวันที่
            document.getElementById('salesPeriod').addEventListener('change', function() {
                renderSalesReport();
            });
            
            // เรนเดอร์รายงาน
            renderSalesReport();
        }

        // เรนเดอร์รายงานยอดขาย
        function renderSalesReport() {
            const period = document.getElementById('salesPeriod').value;
            const today = new Date().toISOString().split('T')[0];
            
            let filteredSales = appState.sales;
            
            // กรองตามช่วงเวลา
            if (period === 'today') {
                filteredSales = appState.sales.filter(sale => sale.date === today);
            } else if (period === 'week') {
                const oneWeekAgo = new Date();
                oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
                const oneWeekAgoStr = oneWeekAgo.toISOString().split('T')[0];
                filteredSales = appState.sales.filter(sale => sale.date >= oneWeekAgoStr);
            } else if (period === 'month') {
                const oneMonthAgo = new Date();
                oneMonthAgo.setMonth(oneMonthAgo.getMonth() - 1);
                const oneMonthAgoStr = oneMonthAgo.toISOString().split('T')[0];
                filteredSales = appState.sales.filter(sale => sale.date >= oneMonthAgoStr);
            } else if (period === 'year') {
                const oneYearAgo = new Date();
                oneYearAgo.setFullYear(oneYearAgo.getFullYear() - 1);
                const oneYearAgoStr = oneYearAgo.toISOString().split('T')[0];
                filteredSales = appState.sales.filter(sale => sale.date >= oneYearAgoStr);
            }
            
            // คำนวณสถิติ
            const totalSales = filteredSales.reduce((sum, sale) => sum + sale.finalTotal, 0);
            const totalCost = filteredSales.reduce((sum, sale) => sum + sale.cost, 0);
            const totalProfit = filteredSales.reduce((sum, sale) => sum + sale.profit, 0);
            const profitMargin = totalSales > 0 ? ((totalProfit / totalSales) * 100).toFixed(1) : 0;
            
            const cashSales = filteredSales.filter(sale => sale.payment === 'cash');
            const cashTotal = cashSales.reduce((sum, sale) => sum + sale.finalTotal, 0);
            const promptpaySales = filteredSales.filter(sale => sale.payment === 'promptpay');
            const promptpayTotal = promptpaySales.reduce((sum, sale) => sum + sale.finalTotal, 0);
            
            // อัพเดทการ์ดสถิติ
            document.getElementById('totalSales').textContent = `${totalSales.toFixed(2)} ฿`;
            document.getElementById('totalSalesCount').textContent = `${filteredSales.length} รายการ`;
            document.getElementById('cashSales').textContent = `${cashTotal.toFixed(2)} ฿`;
            document.getElementById('cashSalesCount').textContent = `${cashSales.length} รายการ`;
            document.getElementById('promptpaySales').textContent = `${promptpayTotal.toFixed(2)} ฿`;
            document.getElementById('promptpaySalesCount').textContent = `${promptpaySales.length} รายการ`;
            document.getElementById('netProfit').textContent = `${totalProfit.toFixed(2)} ฿`;
            document.getElementById('profitMargin').textContent = `${profitMargin}%`;
            
            // อัพเดทสรุปกำไร
            document.getElementById('profitTotalSales').textContent = `${totalSales.toFixed(2)} ฿`;
            document.getElementById('profitTotalCost').textContent = `${totalCost.toFixed(2)} ฿`;
            document.getElementById('profitGross').textContent = `${(totalSales - totalCost).toFixed(2)} ฿`;
            document.getElementById('profitTotalDiscount').textContent = `${filteredSales.reduce((sum, sale) => sum + sale.discount, 0).toFixed(2)} ฿`;
            document.getElementById('profitNet').textContent = `${totalProfit.toFixed(2)} ฿`;
            
            // เรนเดอร์ตารางยอดขาย
            const tableBody = document.querySelector('#salesTable tbody');
            tableBody.innerHTML = '';
            
            if (filteredSales.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="9" style="text-align: center; padding: 20px; color: var(--gray);">ไม่มีข้อมูลการขาย</td></tr>';
                return;
            }
            
            filteredSales.forEach(sale => {
                const row = document.createElement('tr');
                row.className = 'fade-in';
                
                // จัดรูปแบบวันที่
                const dateObj = new Date(sale.date);
                const formattedDate = dateObj.toLocaleDateString('th-TH');
                
                // จัดรูปแบบวิธีการชำระเงิน
                const paymentMethods = {
                    'cash': 'เงินสด',
                    'promptpay': 'พร้อมเพย์'
                };
                
                row.innerHTML = `
                    <td>${formattedDate}</td>
                    <td>${sale.id}</td>
                    <td>${sale.items} ชิ้น</td>
                    <td>${sale.total.toFixed(2)} ฿</td>
                    <td>${sale.discount.toFixed(2)} ฿</td>
                    <td>${sale.finalTotal.toFixed(2)} ฿</td>
                    <td>${sale.profit.toFixed(2)} ฿</td>
                    <td>${paymentMethods[sale.payment] || sale.payment}</td>
                    <td>${sale.user}</td>
                `;
                
                tableBody.appendChild(row);
            });
        }

        // ตั้งค่าการจัดการผู้ใช้
        function setupUsersManagement() {
            // ปุ่มเพิ่มผู้ใช้
            document.getElementById('addUserBtn').addEventListener('click', function() {
                showUserModal();
            });
            
            // เรนเดอร์ตารางผู้ใช้
            renderUsersTable();
        }

        // เรนเดอร์ตารางผู้ใช้
        function renderUsersTable() {
            const tableBody = document.querySelector('#usersTable tbody');
            tableBody.innerHTML = '';
            
            appState.users.forEach(user => {
                const row = document.createElement('tr');
                row.className = 'fade-in';
                
                // แปลงบทบาท
                const roles = {
                    'admin': 'ผู้ดูแลระบบ',
                    'staff': 'พนักงานขาย',
                    'manager': 'ผู้จัดการ'
                };
                
                // จัดรูปแบบวันที่
                const dateObj = new Date(user.created);
                const formattedDate = dateObj.toLocaleDateString('th-TH');
                
                row.innerHTML = `
                    <td>${user.username}</td>
                    <td>${user.name}</td>
                    <td>${roles[user.role] || user.role}</td>
                    <td>${formattedDate}</td>
                    <td>${user.active ? 'ใช้งาน' : 'ปิดใช้งาน'}</td>
                    <td class="action-cell">
                        <button class="action-btn edit-btn" data-id="${user.id}">
                            <i class="fas fa-edit"></i> แก้ไข
                        </button>
                        ${user.username !== appState.currentUser.username ? `
                        <button class="action-btn delete-btn" data-id="${user.id}">
                            <i class="fas fa-trash"></i> ลบ
                        </button>
                        ` : ''}
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // เพิ่ม Event Listeners สำหรับปุ่มจัดการ
            document.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = parseInt(e.target.closest('.edit-btn').getAttribute('data-id'));
                    editUser(id);
                });
            });
            
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = parseInt(e.target.closest('.delete-btn').getAttribute('data-id'));
                    deleteUser(id);
                });
            });
        }

        // แสดง Modal ผู้ใช้
        function showUserModal(user = null) {
            const modal = document.getElementById('userModal');
            const title = document.getElementById('userModalTitle');
            
            appState.editingUser = user;
            
            if (user) {
                title.textContent = 'แก้ไขผู้ใช้';
                document.getElementById('modalUsername').value = user.username;
                document.getElementById('modalName').value = user.name;
                document.getElementById('modalRole').value = user.role;
                document.getElementById('modalPassword').value = '';
                document.getElementById('modalConfirmPassword').value = '';
            } else {
                title.textContent = 'เพิ่มผู้ใช้ใหม่';
                document.getElementById('modalUsername').value = '';
                document.getElementById('modalName').value = '';
                document.getElementById('modalRole').value = 'staff';
                document.getElementById('modalPassword').value = '';
                document.getElementById('modalConfirmPassword').value = '';
            }
            
            modal.classList.add('active');
        }

        // บันทึกผู้ใช้
        function saveUser() {
            const username = document.getElementById('modalUsername').value;
            const name = document.getElementById('modalName').value;
            const role = document.getElementById('modalRole').value;
            const password = document.getElementById('modalPassword').value;
            const confirmPassword = document.getElementById('modalConfirmPassword').value;
            
            if (!username || !name || !role) {
                showNotification('กรุณากรอกข้อมูลให้ครบถ้วน', 'error');
                return;
            }
            
            if (!appState.editingUser && (!password || !confirmPassword)) {
                showNotification('กรุณากรอกรหัสผ่าน', 'error');
                return;
            }
            
            if (password !== confirmPassword) {
                showNotification('รหัสผ่านไม่ตรงกัน', 'error');
                return;
            }
            
            if (appState.editingUser) {
                // แก้ไขผู้ใช้
                appState.editingUser.username = username;
                appState.editingUser.name = name;
                appState.editingUser.role = role;
                if (password) {
                    appState.editingUser.password = password;
                }
                
                showNotification('แก้ไขผู้ใช้เรียบร้อยแล้ว');
                addLog('แก้ไขผู้ใช้', `แก้ไขผู้ใช้ '${username}'`);
            } else {
                // ตรวจสอบว่ามีชื่อผู้ใช้นี้แล้วหรือไม่
                const existingUser = appState.users.find(u => u.username === username);
                if (existingUser) {
                    showNotification('มีชื่อผู้ใช้นี้อยู่ในระบบแล้ว', 'error');
                    return;
                }
                
                // เพิ่มผู้ใช้ใหม่
                const newUser = {
                    id: Date.now(),
                    username: username,
                    name: name,
                    role: role,
                    password: password,
                    created: new Date().toISOString().split('T')[0],
                    active: true
                };
                
                appState.users.push(newUser);
                showNotification('เพิ่มผู้ใช้ใหม่เรียบร้อยแล้ว');
                addLog('เพิ่มผู้ใช้', `เพิ่มผู้ใช้ '${username}'`);
            }
            
            // บันทึกข้อมูลและอัพเดท UI
            saveAppData();
            renderUsersTable();
            document.getElementById('userModal').classList.remove('active');
            appState.editingUser = null;
        }

        // แก้ไขผู้ใช้
        function editUser(id) {
            const user = appState.users.find(u => u.id === id);
            if (user) {
                showUserModal(user);
            }
        }

        // ลบผู้ใช้
        function deleteUser(id) {
            const user = appState.users.find(u => u.id === id);
            
            if (user && user.username === appState.currentUser.username) {
                showNotification('ไม่สามารถลบบัญชีตัวเองได้', 'error');
                return;
            }
            
            if (confirm('คุณแน่ใจว่าต้องการลบผู้ใช้นี้?')) {
                appState.users = appState.users.filter(u => u.id !== id);
                saveAppData();
                renderUsersTable();
                showNotification('ลบผู้ใช้เรียบร้อยแล้ว');
                addLog('ลบผู้ใช้', `ลบผู้ใช้ '${user.username}'`);
            }
        }

        // ตั้งค่าการจัดการสมาชิก
        function setupMembersManagement() {
            // ปุ่มเพิ่มสมาชิก
            document.getElementById('addMemberBtn').addEventListener('click', function() {
                showMemberModal();
            });
            
            // เรนเดอร์ตารางสมาชิก
            renderMembersTable();
        }

        // เรนเดอร์ตารางสมาชิก
        function renderMembersTable() {
            const tableBody = document.querySelector('#membersTable tbody');
            tableBody.innerHTML = '';
            
            appState.members.forEach(member => {
                const row = document.createElement('tr');
                row.className = 'fade-in';
                
                // จัดรูปแบบวันที่
                const dateObj = new Date(member.created);
                const formattedDate = dateObj.toLocaleDateString('th-TH');
                
                row.innerHTML = `
                    <td>${member.code}</td>
                    <td>${member.name}</td>
                    <td>${member.phone}</td>
                    <td>${member.discount}%</td>
                    <td>${member.points}</td>
                    <td>${formattedDate}</td>
                    <td class="action-cell">
                        <button class="action-btn edit-btn" data-id="${member.id}">
                            <i class="fas fa-edit"></i> แก้ไข
                        </button>
                        <button class="action-btn delete-btn" data-id="${member.id}">
                            <i class="fas fa-trash"></i> ลบ
                        </button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // เพิ่ม Event Listeners สำหรับปุ่มจัดการ
            document.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = parseInt(e.target.closest('.edit-btn').getAttribute('data-id'));
                    editMember(id);
                });
            });
            
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = parseInt(e.target.closest('.delete-btn').getAttribute('data-id'));
                    deleteMember(id);
                });
            });
        }

        // แสดง Modal สมาชิก
        function showMemberModal(member = null) {
            const modal = document.getElementById('memberModal');
            const title = document.getElementById('memberModalTitle');
            
            appState.editingMember = member;
            
            if (member) {
                title.textContent = 'แก้ไขสมาชิก';
                document.getElementById('modalMemberName').value = member.name;
                document.getElementById('modalMemberPhone').value = member.phone;
                document.getElementById('modalMemberDiscount').value = member.discount;
            } else {
                title.textContent = 'เพิ่มสมาชิกใหม่';
                document.getElementById('modalMemberName').value = '';
                document.getElementById('modalMemberPhone').value = '';
                document.getElementById('modalMemberDiscount').value = '5';
            }
            
            modal.classList.add('active');
        }

        // บันทึกสมาชิก
        function saveMember() {
            const name = document.getElementById('modalMemberName').value;
            const phone = document.getElementById('modalMemberPhone').value;
            const discount = parseInt(document.getElementById('modalMemberDiscount').value);
            
            if (!name || !phone) {
                showNotification('กรุณากรอกข้อมูลให้ครบถ้วน', 'error');
                return;
            }
            
            if (appState.editingMember) {
                // แก้ไขสมาชิก
                appState.editingMember.name = name;
                appState.editingMember.phone = phone;
                appState.editingMember.discount = discount;
                
                showNotification('แก้ไขสมาชิกเรียบร้อยแล้ว');
                addLog('แก้ไขสมาชิก', `แก้ไขสมาชิก '${name}'`);
            } else {
                // เพิ่มสมาชิกใหม่
                const newMember = {
                    id: Date.now(),
                    code: 'M' + (appState.members.length + 1).toString().padStart(3, '0'),
                    name: name,
                    phone: phone,
                    discount: discount,
                    points: 0,
                    created: new Date().toISOString().split('T')[0]
                };
                
                appState.members.push(newMember);
                showNotification('เพิ่มสมาชิกใหม่เรียบร้อยแล้ว');
                addLog('เพิ่มสมาชิก', `เพิ่มสมาชิก '${name}'`);
            }
            
            // บันทึกข้อมูลและอัพเดท UI
            saveAppData();
            renderMembersTable();
            document.getElementById('memberModal').classList.remove('active');
            appState.editingMember = null;
        }

        // แก้ไขสมาชิก
        function editMember(id) {
            const member = appState.members.find(m => m.id === id);
            if (member) {
                showMemberModal(member);
            }
        }

        // ลบสมาชิก
        function deleteMember(id) {
            if (confirm('คุณแน่ใจว่าต้องการลบสมาชิกนี้?')) {
                const member = appState.members.find(m => m.id === id);
                appState.members = appState.members.filter(m => m.id !== id);
                saveAppData();
                renderMembersTable();
                showNotification('ลบสมาชิกเรียบร้อยแล้ว');
                addLog('ลบสมาชิก', `ลบสมาชิก '${member.name}'`);
            }
        }

        // ตั้งค่าการจัดการโค้ดส่วนลด
        function setupDiscountCodesManagement() {
            // ปุ่มเพิ่มโค้ดส่วนลด
            document.getElementById('addDiscountCodeBtn').addEventListener('click', function() {
                showDiscountCodeModal();
            });
            
            // เรนเดอร์ตารางโค้ดส่วนลด
            renderDiscountCodesTable();
        }

        // เรนเดอร์ตารางโค้ดส่วนลด
        function renderDiscountCodesTable() {
            const tableBody = document.querySelector('#discountCodesTable tbody');
            tableBody.innerHTML = '';
            
            appState.discountCodes.forEach(discountCode => {
                const row = document.createElement('tr');
                row.className = 'fade-in';
                
                // จัดรูปแบบวันที่
                const createdDate = new Date();
                const formattedCreatedDate = createdDate.toLocaleDateString('th-TH');
                
                let formattedExpiryDate = '-';
                if (discountCode.expiryDate) {
                    const expiryDate = new Date(discountCode.expiryDate);
                    formattedExpiryDate = expiryDate.toLocaleDateString('th-TH');
                }
                
                let usesText = `${discountCode.usedCount} ครั้ง`;
                if (discountCode.maxUses) {
                    usesText += ` / ${discountCode.maxUses} ครั้ง`;
                } else {
                    usesText += ' / ไม่จำกัด';
                }
                
                row.innerHTML = `
                    <td>${discountCode.code}</td>
                    <td>${discountCode.discount} ${discountCode.type === 'percent' ? '%' : '฿'}</td>
                    <td>${discountCode.type === 'percent' ? 'เปอร์เซ็นต์' : 'จำนวนเงิน'}</td>
                    <td>${discountCode.minAmount} ฿</td>
                    <td>${usesText}</td>
                    <td>${formattedCreatedDate}</td>
                    <td>${formattedExpiryDate}</td>
                    <td>${discountCode.active ? 'ใช้งาน' : 'ปิดใช้งาน'}</td>
                    <td class="action-cell">
                        ${appState.currentUser.role === 'admin' ? `
                        <button class="action-btn edit-btn" data-id="${discountCode.id}">
                            <i class="fas fa-edit"></i> แก้ไข
                        </button>
                        <button class="action-btn delete-btn" data-id="${discountCode.id}">
                            <i class="fas fa-trash"></i> ลบ
                        </button>
                        ` : 'ดูได้อย่างเดียว'}
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // เพิ่ม Event Listeners สำหรับปุ่มจัดการ (เฉพาะ admin)
            if (appState.currentUser.role === 'admin') {
                document.querySelectorAll('.edit-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const id = parseInt(e.target.closest('.edit-btn').getAttribute('data-id'));
                        editDiscountCode(id);
                    });
                });
                
                document.querySelectorAll('.delete-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const id = parseInt(e.target.closest('.delete-btn').getAttribute('data-id'));
                        deleteDiscountCode(id);
                    });
                });
            }
        }

        // แสดง Modal โค้ดส่วนลด
        function showDiscountCodeModal(discountCode = null) {
            const modal = document.getElementById('discountCodeModal');
            const title = document.getElementById('discountCodeModalTitle');
            
            appState.editingDiscountCode = discountCode;
            
            if (discountCode) {
                title.textContent = 'แก้ไขโค้ดส่วนลด';
                document.getElementById('modalDiscountCode').value = discountCode.code;
                document.getElementById('modalDiscountValue').value = discountCode.discount;
                document.getElementById('modalDiscountType').value = discountCode.type;
                document.getElementById('modalDiscountMinAmount').value = discountCode.minAmount;
                document.getElementById('modalDiscountMaxUses').value = discountCode.maxUses || '';
                document.getElementById('modalDiscountExpiryDate').value = discountCode.expiryDate || '';
            } else {
                title.textContent = 'เพิ่มโค้ดส่วนลด';
                document.getElementById('modalDiscountCode').value = '';
                document.getElementById('modalDiscountValue').value = '';
                document.getElementById('modalDiscountType').value = 'percent';
                document.getElementById('modalDiscountMinAmount').value = '0';
                document.getElementById('modalDiscountMaxUses').value = '';
                document.getElementById('modalDiscountExpiryDate').value = '';
            }
            
            modal.classList.add('active');
        }

        // บันทึกโค้ดส่วนลด
        function saveDiscountCode() {
            const code = document.getElementById('modalDiscountCode').value;
            const discount = parseFloat(document.getElementById('modalDiscountValue').value);
            const type = document.getElementById('modalDiscountType').value;
            const minAmount = parseFloat(document.getElementById('modalDiscountMinAmount').value);
            const maxUses = document.getElementById('modalDiscountMaxUses').value ? parseInt(document.getElementById('modalDiscountMaxUses').value) : null;
            const expiryDate = document.getElementById('modalDiscountExpiryDate').value || null;
            
            if (!code || !discount || isNaN(minAmount)) {
                showNotification('กรุณากรอกข้อมูลให้ครบถ้วน', 'error');
                return;
            }
            
            if (appState.editingDiscountCode) {
                // แก้ไขโค้ดส่วนลด
                appState.editingDiscountCode.code = code;
                appState.editingDiscountCode.discount = discount;
                appState.editingDiscountCode.type = type;
                appState.editingDiscountCode.minAmount = minAmount;
                appState.editingDiscountCode.maxUses = maxUses;
                appState.editingDiscountCode.expiryDate = expiryDate;
                
                showNotification('แก้ไขโค้ดส่วนลดเรียบร้อยแล้ว');
                addLog('แก้ไขโค้ดส่วนลด', `แก้ไขโค้ดส่วนลด '${code}'`);
            } else {
                // ตรวจสอบว่ามีโค้ดนี้แล้วหรือไม่
                const existingCode = appState.discountCodes.find(dc => dc.code === code);
                if (existingCode) {
                    showNotification('มีโค้ดส่วนลดนี้อยู่ในระบบแล้ว', 'error');
                    return;
                }
                
                // เพิ่มโค้ดส่วนลดใหม่
                const newDiscountCode = {
                    id: Date.now(),
                    code: code,
                    discount: discount,
                    type: type,
                    minAmount: minAmount,
                    maxUses: maxUses,
                    usedCount: 0,
                    expiryDate: expiryDate,
                    active: true
                };
                
                appState.discountCodes.push(newDiscountCode);
                showNotification('เพิ่มโค้ดส่วนลดใหม่เรียบร้อยแล้ว');
                addLog('เพิ่มโค้ดส่วนลด', `เพิ่มโค้ดส่วนลด '${code}'`);
            }
            
            // บันทึกข้อมูลและอัพเดท UI
            saveAppData();
            renderDiscountCodesTable();
            document.getElementById('discountCodeModal').classList.remove('active');
            appState.editingDiscountCode = null;
        }

        // แก้ไขโค้ดส่วนลด
        function editDiscountCode(id) {
            const discountCode = appState.discountCodes.find(dc => dc.id === id);
            if (discountCode) {
                showDiscountCodeModal(discountCode);
            }
        }

        // ลบโค้ดส่วนลด
        function deleteDiscountCode(id) {
            if (confirm('คุณแน่ใจว่าต้องการลบโค้ดส่วนลดนี้?')) {
                const discountCode = appState.discountCodes.find(dc => dc.id === id);
                appState.discountCodes = appState.discountCodes.filter(dc => dc.id !== id);
                saveAppData();
                renderDiscountCodesTable();
                showNotification('ลบโค้ดส่วนลดเรียบร้อยแล้ว');
                addLog('ลบโค้ดส่วนลด', `ลบโค้ดส่วนลด '${discountCode.code}'`);
            }
        }

        // ตั้งค่าการจัดการ QR
        function setupQrManagement() {
            // ปุ่มเพิ่ม QR
            document.getElementById('addQrBtn').addEventListener('click', function() {
                showNotification('ฟังก์ชันเพิ่ม QR กำลังพัฒนา', 'info');
            });
            
            // เรนเดอร์ตาราง QR
            renderQrTable();
        }

        // เรนเดอร์ตาราง QR
        function renderQrTable() {
            const tableBody = document.querySelector('#qrTable tbody');
            tableBody.innerHTML = '';
            
            appState.qrCodes.forEach(qr => {
                const row = document.createElement('tr');
                row.className = 'fade-in';
                
                // สร้าง URL QR Code ตัวอย่าง
                const qrUrl = `https://promptpay.io/${qr.phone}/100.png`;
                
                row.innerHTML = `
                    <td>${qr.name}</td>
                    <td>${qr.phone}</td>
                    <td><img src="${qrUrl}" alt="QR Code" style="width: 100px; height: 100px; object-fit: cover; border: 1px solid #ddd; padding: 5px;"></td>
                    <td>${qr.active ? 'ใช้งาน' : 'ปิดใช้งาน'}</td>
                    <td class="action-cell">
                        <button class="action-btn edit-btn" data-id="${qr.id}">
                            <i class="fas fa-edit"></i> แก้ไข
                        </button>
                        <button class="action-btn delete-btn" data-id="${qr.id}">
                            <i class="fas fa-trash"></i> ลบ
                        </button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
        }

        // ตั้งค่าประวัติการขาย
        function setupLogs() {
            renderLogs();
        }

        // เรนเดอร์ประวัติการขาย
        function renderLogs() {
            const logsContainer = document.getElementById('logsContainer');
            logsContainer.innerHTML = '';
            
            if (appState.logs.length === 0) {
                logsContainer.innerHTML = '<p style="text-align: center; padding: 20px; color: var(--gray);">ไม่มีประวัติการขาย</p>';
                return;
            }
            
            // แสดงเฉพาะ 50 รายการล่าสุด
            const recentLogs = appState.logs.slice(0, 50);
            
            recentLogs.forEach(log => {
                const logItem = document.createElement('div');
                logItem.className = 'log-item';
                
                const dateObj = new Date(log.timestamp);
                const formattedTime = dateObj.toLocaleString('th-TH');
                
                logItem.innerHTML = `
                    <div>
                        <div class="log-action">${log.action}</div>
                        <div class="log-details">${log.details}</div>
                    </div>
                    <div style="text-align: right;">
                        <div class="log-user">${log.user}</div>
                        <div class="log-time">${formattedTime}</div>
                    </div>
                `;
                
                logsContainer.appendChild(logItem);
            });
        }

        // เพิ่ม Log
        function addLog(action, details) {
            const log = {
                id: Date.now(),
                action: action,
                user: appState.currentUser.name,
                details: details,
                timestamp: new Date().toISOString().replace('T', ' ').substring(0, 19)
            };
            
            appState.logs.unshift(log);
            saveAppData();
            
            // อัพเดทหน้าประวัติการขายถ้าอยู่ในหน้านั้น
            if (appState.currentScreen === 'logs') {
                renderLogs();
            }
        }

        // ตั้งค่าการตั้งค่า
        function setupSettings() {
            // โหลดการตั้งค่าปัจจุบัน
            loadSettings();
            
            // ปุ่มบันทึกการตั้งค่า
            document.getElementById('saveSettingsBtn').addEventListener('click', function() {
                saveSettings();
            });
            
            // ปุ่มสำรองข้อมูล
            document.getElementById('backupDataBtn').addEventListener('click', function() {
                document.getElementById('backupModal').classList.add('active');
            });
            
            // ปุ่มกู้คืนข้อมูล
            document.getElementById('restoreDataBtn').addEventListener('click', function() {
                document.getElementById('restoreModal').classList.add('active');
            });
        }

        // โหลดการตั้งค่า
        function loadSettings() {
            document.getElementById('shopName').value = appState.settings.shopName || 'Startosphere';
            document.getElementById('shopPhone').value = appState.settings.shopPhone || '0988722639';
            document.getElementById('shopAddress').value = appState.settings.shopAddress || 'ระยอง';
            document.getElementById('openTime').value = appState.settings.openTime || '08:00';
            document.getElementById('closeTime').value = appState.settings.closeTime || '20:00';
        }

        // บันทึกการตั้งค่า
        function saveSettings() {
            appState.settings.shopName = document.getElementById('shopName').value;
            appState.settings.shopPhone = document.getElementById('shopPhone').value;
            appState.settings.shopAddress = document.getElementById('shopAddress').value;
            appState.settings.openTime = document.getElementById('openTime').value;
            appState.settings.closeTime = document.getElementById('closeTime').value;
            
            completeSaveSettings();
        }

        // บันทึกการตั้งค่า (ส่วนต่อเนื่องจาก saveSettings)
        function completeSaveSettings() {
            saveAppData();
            showNotification('บันทึกการตั้งค่าเรียบร้อยแล้ว');
            addLog('อัพเดทการตั้งค่า', 'อัพเดทการตั้งค่าร้าน');
            
            // อัพเดทชื่อร้านใน Sidebar
            document.querySelector('.logo h1 span').textContent = appState.settings.shopName;
        }

        // สำรองข้อมูล
        function backupData() {
            const password = document.getElementById('backupPassword').value;
            
            if (!password) {
                showNotification('กรุณากรอกรหัสผ่าน', 'error');
                return;
            }
            
            if (password !== '159753147258369') {
                showNotification('รหัสผ่านไม่ถูกต้อง', 'error');
                return;
            }
            
            const data = {
                products: appState.products,
                users: appState.users,
                sales: appState.sales,
                settings: appState.settings,
                members: appState.members,
                discountCodes: appState.discountCodes,
                qrCodes: appState.qrCodes,
                logs: appState.logs,
                backupDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `pos-backup-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            document.getElementById('backupModal').classList.remove('active');
            showNotification('สำรองข้อมูลเรียบร้อยแล้ว');
            addLog('สำรองข้อมูล', 'สำรองข้อมูลระบบ');
        }

        // กู้คืนข้อมูล
        function restoreData() {
            const password = document.getElementById('restorePassword').value;
            const fileInput = document.getElementById('backupFile');
            const file = fileInput.files[0];
            
            if (!password) {
                showNotification('กรุณากรอกรหัสผ่าน', 'error');
                return;
            }
            
            if (password !== '159753147258369') {
                showNotification('รหัสผ่านไม่ถูกต้อง', 'error');
                return;
            }
            
            if (!file) {
                showNotification('กรุณาเลือกไฟล์ข้อมูล', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    // อัพเดทข้อมูล
                    appState.products = data.products || [];
                    appState.users = data.users || [];
                    appState.sales = data.sales || [];
                    appState.settings = data.settings || {};
                    appState.members = data.members || [];
                    appState.discountCodes = data.discountCodes || [];
                    
                    // อัพเดท QR Codes ด้วยเบอร์โทรพร้อมเพย์ที่ตั้งค่า
                    const qrCodesData = data.qrCodes || sampleData.qrCodes;
                    if (qrCodesData.length > 0) {
                        qrCodesData[0].phone = PROMPTPAY_ID;
                    }
                    appState.qrCodes = qrCodesData;
                    
                    appState.logs = data.logs || [];
                    
                    // บันทึกข้อมูล
                    saveAppData();
                    
                    // รีโหลด UI
                    renderProductsTable();
                    renderUsersTable();
                    renderSalesReport();
                    renderMembersTable();
                    renderDiscountCodesTable();
                    renderQrTable();
                    renderLogs();
                    loadSettings();
                    
                    document.getElementById('restoreModal').classList.remove('active');
                    showNotification('กู้คืนข้อมูลเรียบร้อยแล้ว');
                    addLog('กู้คืนข้อมูล', 'กู้คืนข้อมูลระบบ');
                } catch (error) {
                    showNotification('ไฟล์ข้อมูลไม่ถูกต้อง', 'error');
                }
            };
            reader.readAsText(file);
        }

        // เริ่มต้นแอปพลิเคชันเมื่อโหลดหน้าเว็บ
        window.addEventListener('DOMContentLoaded', function() {
            loadAppData();
            setupLogin();
        });
    </script>
</body>
</html>